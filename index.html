<!DOCTYPE html>

<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ•Œ Hajiawa Ultra Supreme | Ù†Û•Ø®Ø´Û•ÛŒ Ø²ÛŒØ±Û•Ú©ÛŒ Ù¾ÛØ´Ú©Û•ÙˆØªÙˆÙˆ</title>

<meta name="theme-color" content="#020617">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ø²ÛŒØ±Û•Ú©ÛŒ Ù†Û•Ø®Ø´Û•Ø³Ø§Ø²ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§ - Ultra Supreme Edition">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<!-- Core Libraries -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<!-- Prayer Times Library -->
<script src="https://cdn.jsdelivr.net/npm/adhan@4.4.4/PostDist/adhan.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">

<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    ultra: { 
                        dark: '#020617', 
                        darker: '#0f172a',
                        card: 'rgba(15, 23, 42, 0.85)', 
                        accent: '#3b82f6',
                        gold: '#fbbf24'
                    }
                },
                fontFamily: { 
                    sans: ['Vazirmatn', 'sans-serif'] 
                }
            }
        }
    }
</script>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { 
        height: 100%; margin: 0; padding: 0; background: #020617; overflow: hidden; 
        font-family: 'Vazirmatn', sans-serif;
        -webkit-font-smoothing: antialiased;
    }

    .bg-animated {
        position: fixed; inset: 0;
        background: 
            radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
        animation: pulse-bg 8s ease-in-out infinite;
        pointer-events: none; z-index: 0;
    }
    @keyframes pulse-bg { 
        0%, 100% { opacity: 0.4; } 
        50% { opacity: 0.7; } 
    }

    #map { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; }
    .leaflet-control-attribution, .leaflet-control-zoom, .leaflet-routing-container { display: none !important; }

    .glass {
        background: rgba(15, 23, 42, 0.88);
        backdrop-filter: blur(24px) saturate(180%);
        border: 1.5px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(59, 130, 246, 0.1);
    }

    .glass-light {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .marker-funeral {
        width: 52px; height: 52px;
        background: linear-gradient(135deg, #ef4444, #dc2626);
        border: 4px solid white; border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        display: flex; align-items: center; justify-content: center;
        color: white;
        box-shadow: 0 6px 24px rgba(239, 68, 68, 0.6);
        animation: marker-bounce 2s infinite ease-in-out;
        position: relative; cursor: pointer;
    }

    .marker-funeral::before {
        content: ''; position: absolute; inset: -12px;
        border: 3px solid rgba(239, 68, 68, 0.3);
        border-radius: 50% 50% 50% 0;
        animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
    }

    .marker-funeral i {
        transform: rotate(45deg); font-size: 22px;
    }

    .marker-mosque {
        width: 40px; height: 40px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        border: 3px solid white; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        color: white;
        box-shadow: 0 4px 16px rgba(251, 191, 36, 0.5);
        transition: all 0.3s; cursor: pointer;
    }

    .marker-mosque:hover { transform: scale(1.2); }
    .marker-mosque i { font-size: 18px; }

    @keyframes marker-bounce {
        0%, 100% { transform: translateY(0) rotate(-45deg); }
        50% { transform: translateY(-18px) rotate(-45deg); }
    }

    @keyframes ping {
        0% { transform: scale(1); opacity: 1; }
        75%, 100% { transform: scale(1.8); opacity: 0; }
    }

    .user-marker {
        width: 20px; height: 20px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        border: 4px solid white; border-radius: 50%;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.8);
        animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8); }
        50% { box-shadow: 0 0 50px rgba(59, 130, 246, 1); }
    }

    .loader-supreme {
        width: 50px; height: 50px;
        border: 4px solid rgba(59, 130, 246, 0.2);
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .modal-container {
        position: fixed; inset: 0;
        background: rgba(0, 0, 0, 0.92);
        backdrop-filter: blur(8px);
        z-index: 7000; display: none;
        align-items: center; justify-content: center;
        padding: 20px;
    }

    .toast-container {
        position: fixed; top: 24px; left: 50%;
        transform: translateX(-50%) translateY(-120px);
        z-index: 8000;
        transition: transform 0.4s;
    }

    .toast-container.show {
        transform: translateX(-50%) translateY(0);
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #3b82f6, #2563eb); border-radius: 10px; }

    input:focus, select:focus { outline: none; border-color: rgba(59, 130, 246, 0.6) !important; }

    .prayer-next {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.2)) !important;
        border: 2px solid rgba(59, 130, 246, 0.5) !important;
        box-shadow: 0 0 24px rgba(59, 130, 246, 0.4) !important;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    
    .admin-btn-pulse {
        animation: admin-pulse 2s infinite;
    }
    
    @keyframes admin-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
        50% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
    }

    /* ÙÛ†Ù†ØªÛ• Ù†ÙˆÛÛŒÛ•Ú©Ø§Ù† Ø¨Û† Ø¹Û•Ø±Û•Ø¨ÛŒ Ùˆ Ú©ÙˆØ±Ø¯ÛŒ */
    .prayer-arabic {
        font-family: 'Amiri', serif !important;
        font-size: 22px !important;
        line-height: 1.8 !important;
        letter-spacing: 0.5px !important;
        text-align: justify !important;
        direction: rtl !important;
    }

    .prayer-kurdish {
        font-family: 'Vazirmatn', sans-serif !important;
        font-size: 14px !important;
        line-height: 1.6 !important;
        text-align: justify !important;
    }
</style>

</head>

<body class="text-white">

<div class="bg-animated"></div>

<!-- Splash Screen -->
<div id="splashScreen" class="fixed inset-0 z-[9999] bg-gradient-to-br from-ultra-dark via-ultra-darker to-purple-950 flex flex-col items-center justify-center transition-opacity duration-700">
    <div class="relative mb-8" style="animation: float 3s ease-in-out infinite;">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-500 rounded-[32px] blur-3xl opacity-40"></div>
        <div class="relative w-32 h-32 rounded-[32px] bg-gradient-to-br from-blue-500 via-purple-500 to-blue-600 flex items-center justify-center shadow-2xl">
            <i class="fas fa-kaaba text-6xl text-white"></i>
        </div>
    </div>
    
    <h1 class="text-5xl font-black tracking-[0.25em] mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400">
        HAJIAWA
    </h1>
    
    <div class="flex items-center gap-3 mb-2">
        <div class="h-[2px] w-12 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
        <p class="text-blue-400 text-sm font-bold tracking-[0.3em]">ULTRA SUPREME</p>
        <div class="h-[2px] w-12 bg-gradient-to-r from-transparent via-purple-500 to-transparent"></div>
    </div>
    
    <p class="text-gray-500 text-xs font-mono mb-10">Ù†Û•Ø®Ø´Û•ÛŒ Ø²ÛŒØ±Û•Ú©ÛŒ Ù¾ÛØ´Ú©Û•ÙˆØªÙˆÙˆ v7.0</p>
    
    <div class="loader-supreme mb-6"></div>
    
    <p id="loadStatus" class="text-gray-400 text-sm font-medium">Ø¬Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø³ÛŒØ³ØªÛ•Ù…...</p>
    <!-- Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯ÙˆÚ¯Ù…Û•ÛŒ ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ• -->
    <button onclick="skipLoading()" class="mt-6 text-xs text-gray-500 hover:text-gray-300 transition">
        <i class="fas fa-forward ml-1"></i>ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø´ØªÚ¯Ø±ÛØ¯Ø§Ù†
    </button>
</div>

<div id="map"></div>

<!-- Top Header -->
<div class="fixed top-0 inset-x-0 z-[5000] p-4 bg-gradient-to-b from-black/90 via-black/60 to-transparent pointer-events-none">
    <!-- Ú•ÛŒØ²ÛÚ©ÛŒ ÛŒÛ•Ú©Û•Ù… Ø¨Û† Ù†Ø§Ùˆ Ùˆ Ú¯Û•Ú•Ø§Ù† -->
    <div class="flex items-center justify-between pointer-events-auto max-w-2xl mx-auto gap-3 mb-2">
        <div class="glass rounded-2xl px-4 py-2 flex items-center gap-3 shadow-2xl">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center shadow-lg">
                <i class="fas fa-kaaba text-white text-lg"></i>
            </div>
            <div class="hidden sm:block">
                <h1 class="text-sm font-black tracking-tight">HAJIAWA</h1>
                <p class="text-[10px] text-gray-400">Ultra Supreme</p>
            </div>
        </div>

        <div class="flex-1 glass rounded-2xl p-3 flex items-center gap-3 shadow-xl max-w-md">
            <i class="fas fa-search text-blue-400 text-sm"></i>
            <input id="searchInput" type="text" oninput="handleSearch()" placeholder="Ú¯Û•Ú•Ø§Ù† Ø¨Û† Ù…Ø²Ú¯Û•ÙˆØª ÛŒØ§Ù† Ù¾Ø±Ø³Û•..." class="bg-transparent border-none outline-none w-full text-sm text-white placeholder-gray-500">
            <button onclick="clearSearch()" class="w-7 h-7 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center transition">
                <i class="fas fa-times text-gray-400 text-xs"></i>
            </button>
        </div>
    </div>
    
    <!-- Ú•ÛŒØ²ÛÚ©ÛŒ Ø¯ÙˆÙˆÛ•Ù… Ø¨Û† Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù† -->
    <div class="flex items-center justify-between pointer-events-auto max-w-2xl mx-auto gap-2">
        <div class="flex items-center gap-2">
            <button onclick="showAllMosques()" class="w-11 h-11 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition active:scale-95" title="Ù‡Û•Ù…ÙˆÙˆ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†">
                <i class="fas fa-expand-alt text-green-400"></i>
            </button>
            <button onclick="toggleModal('statsModal')" class="w-11 h-11 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition active:scale-95 relative" title="Ø¦Ø§Ù…Ø§Ø±">
                <i class="fas fa-chart-line text-purple-400"></i>
                <span id="statsNotif" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-[10px] font-bold flex items-center justify-center border-2 border-ultra-dark hidden">!</span>
            </button>
            <button onclick="toggleModal('prayerModal')" class="w-11 h-11 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition active:scale-95 relative" title="Ú©Ø§ØªÛŒ Ù†ÙˆÛÚ˜">
                <i class="fas fa-clock text-blue-400"></i>
                <span id="prayerNotif" class="absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full text-[10px] font-bold flex items-center justify-center border-2 border-ultra-dark hidden">1</span>
            </button>
            <button onclick="toggleMapStyleMenu()" class="w-11 h-11 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition active:scale-95" title="Ø¬Û†Ø±ÛŒ Ù†Û•Ø®Ø´Û•">
                <i class="fas fa-map text-orange-400"></i>
            </button>
            <button onclick="toggleModal('adminModal')" class="w-11 h-11 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition active:scale-95 admin-btn-pulse" title="Ø¦Û•Ø¯Ù…ÛŒÙ†">
                <i class="fas fa-shield-alt text-yellow-400"></i>
            </button>
        </div>
        
        <div id="funeralBadge" class="hidden glass rounded-2xl px-4 py-2 flex items-center gap-3 border border-red-500/30 shadow-xl">
            <div class="w-3 h-3 rounded-full bg-red-500 animate-ping absolute"></div>
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <span id="funeralCount" class="text-sm font-bold text-red-200">0 Ù¾Ø±Ø³Û•</span>
            <i class="fas fa-hands-praying text-red-400"></i>
        </div>
    </div>
</div>

<!-- Map Style Menu -->
<div id="mapStyleMenu" class="fixed top-20 right-4 z-[6000] glass p-3 rounded-2xl shadow-2xl hidden">
    <div class="grid grid-cols-2 gap-2">
        <button onclick="changeMapStyle('dark')" class="p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition flex flex-col items-center gap-1">
            <i class="fas fa-moon text-white text-xl"></i>
            <span class="text-xs">ØªØ§Ø±ÛŒÚ©</span>
        </button>
        <button onclick="changeMapStyle('satellite')" class="p-3 rounded-xl bg-blue-700 hover:bg-blue-600 transition flex flex-col items-center gap-1">
            <i class="fas fa-satellite text-white text-xl"></i>
            <span class="text-xs">Ø³Û•ØªÛ•Ù„Ø§ÛŒØª</span>
        </button>
        <button onclick="changeMapStyle('street')" class="p-3 rounded-xl bg-green-700 hover:bg-green-600 transition flex flex-col items-center gap-1">
            <i class="fas fa-road text-white text-xl"></i>
            <span class="text-xs">Ø´Û•Ù‚Ø§Ù…</span>
        </button>
        <button onclick="changeMapStyle('terrain')" class="p-3 rounded-xl bg-yellow-700 hover:bg-yellow-600 transition flex flex-col items-center gap-1">
            <i class="fas fa-mountain text-white text-xl"></i>
            <span class="text-xs">ØªÛŒØ±ÛÙ†</span>
        </button>
    </div>
</div>

<!-- Bottom Actions -->
<div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[5000] pointer-events-none">
    <div class="glass p-2.5 rounded-[28px] flex items-center gap-2 pointer-events-auto shadow-2xl">
        <button onclick="locateUser()" class="w-14 h-14 rounded-[20px] bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-xl text-white shadow-lg transition active:scale-90">
            <i class="fas fa-location-crosshairs"></i>
        </button>
        <div class="w-[2px] h-8 bg-white/10"></div>
        <button onclick="toggleModal('janazaModal')" class="w-14 h-14 rounded-[20px] glass-light hover:bg-white/15 flex items-center justify-center text-xl text-green-400 transition active:scale-90">
            <i class="fas fa-book-quran"></i>
        </button>
        <button onclick="shareApp()" class="w-14 h-14 rounded-[20px] glass-light hover:bg-white/15 flex items-center justify-center text-xl text-yellow-400 transition active:scale-90">
            <i class="fas fa-share-nodes"></i>
        </button>
    </div>
</div>

<!-- Detail Card -->
<div id="detailCard" class="fixed bottom-0 inset-x-0 z-[6000] glass rounded-t-[32px] p-6 transform translate-y-full transition-all duration-500 max-h-[70vh] overflow-y-auto">
    <div class="w-20 h-1.5 bg-white/20 rounded-full mx-auto mb-6"></div>
    
    <button onclick="closeCard()" class="absolute top-6 left-6 w-10 h-10 rounded-xl glass-light flex items-center justify-center hover:bg-white/20 transition">
        <i class="fas fa-times text-gray-400"></i>
    </button>

    <div class="flex flex-col items-center mb-6">
        <div class="relative mb-4">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full blur-xl opacity-40"></div>
            <div id="cardIcon" class="relative w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full border-4 border-ultra-dark flex items-center justify-center shadow-2xl">
                <i class="fas fa-mosque text-3xl text-white"></i>
            </div>
        </div>
        
        <h2 id="cardTitle" class="text-2xl font-black mb-2 text-center">...</h2>
        <span id="cardDistance" class="hidden px-3 py-1 bg-blue-500/20 border border-blue-500/40 rounded-lg text-blue-300 text-sm font-bold">
            <i class="fas fa-route ml-1"></i>
            <span id="cardDistText">0.0 km</span>
        </span>
    </div>

    <div id="cardDetails" class="glass-light p-4 rounded-2xl mb-4 hidden">
        <h3 class="font-bold text-sm mb-2 text-blue-400"><i class="fas fa-info-circle ml-1"></i>Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ</h3>
        <p id="cardDescription" class="text-sm text-gray-300"></p>
    </div>

    <div id="cardFuneralAlert" class="hidden glass-light p-5 rounded-2xl mb-6 border-r-4 border-red-500">
        <div class="flex items-start gap-4">
            <div class="w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-hands-praying text-white text-xl"></i>
            </div>
            <div>
                <h3 class="font-bold text-red-200 text-sm mb-1"><i class="fas fa-exclamation-circle ml-1"></i>Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ Ù¾Ø±Ø³Û•</h3>
                <p id="cardDeadName" class="text-white font-bold">...</p>
                <p id="cardPrayerTime" class="text-gray-400 text-sm"><i class="fas fa-clock ml-1"></i>...</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3">
        <button onclick="startNavigation()" class="bg-gradient-to-r from-blue-600 to-blue-500 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg">
            <i class="fas fa-location-arrow"></i>Ú•ÛÚ¯Ø§
        </button>
        <button onclick="shareLocation()" class="glass-light py-4 rounded-2xl font-bold flex items-center justify-center gap-2">
            <i class="fas fa-share-nodes"></i>Ù‡Ø§ÙˆØ¨Û•Ø´
        </button>
    </div>
</div>

<!-- Stats Modal -->
<div id="statsModal" class="modal-container" onclick="if(event.target==this) toggleModal('statsModal')">
    <div class="glass w-full max-w-lg rounded-[32px] p-6 shadow-2xl max-h-[85vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-black">Ø¦Ø§Ù…Ø§Ø±</h2>
            <button onclick="toggleModal('statsModal')" class="w-10 h-10 rounded-xl glass-light flex items-center justify-center">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="glass-light p-4 rounded-2xl">
                <i class="fas fa-mosque text-4xl text-yellow-400 mb-2"></i>
                <p class="text-3xl font-black" id="totalMosques">0</p>
                <p class="text-xs text-gray-400">Ú©Û†ÛŒ Ù…Ø²Ú¯Û•ÙˆØª</p>
            </div>
            <div class="glass-light p-4 rounded-2xl">
                <i class="fas fa-hands-praying text-4xl text-red-400 mb-2"></i>
                <p class="text-3xl font-black" id="activeFunerals">0</p>
                <p class="text-xs text-gray-400">Ù¾Ø±Ø³Û• Ú†Ø§Ù„Ø§Ú©</p>
            </div>
            <div class="glass-light p-4 rounded-2xl">
                <i class="fas fa-users text-4xl text-blue-400 mb-2"></i>
                <p class="text-3xl font-black">324</p>
                <p class="text-xs text-gray-400">Ø³Û•Ø±Ø¯Ø§Ù†</p>
            </div>
            <div class="glass-light p-4 rounded-2xl">
                <i class="fas fa-map-marked-alt text-4xl text-green-400 mb-2"></i>
                <p class="text-3xl font-black" id="nearbyCount">0</p>
                <p class="text-xs text-gray-400">Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù†Ø²ÛŒÚ©</p>
            </div>
        </div>
        <div class="glass-light p-5 rounded-2xl">
            <h3 class="font-bold text-sm mb-4 text-blue-400"><i class="fas fa-list-ul ml-1"></i>Ù¾Ø±Ø³Û•Ú©Ø§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†</h3>
            <div id="todayFuneralsList" class="space-y-2"></div>
        </div>
    </div>
</div>

<!-- Prayer Modal -->
<div id="prayerModal" class="modal-container" onclick="if(event.target==this) toggleModal('prayerModal')">
    <div class="glass w-full max-w-md rounded-[32px] p-8 shadow-2xl text-center">
        <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center shadow-2xl">
            <i class="fas fa-clock text-3xl text-white"></i>
        </div>
        <h2 class="text-2xl font-black mb-4">Ú©Ø§ØªÛŒ Ù†ÙˆÛÚ˜</h2>
        <div id="currentTime" class="mb-6">
            <div class="text-lg font-mono font-bold">--:--:--</div>
            <div class="text-xs text-gray-400 mt-1">Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†...</div>
        </div>
        <div id="prayerList" class="w-full"></div>
        <button onclick="toggleModal('prayerModal')" class="mt-8 text-gray-500 text-sm">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>
</div>

<!-- Janaza Modal -->
<div id="janazaModal" class="modal-container" onclick="if(event.target==this) toggleModal('janazaModal')">
    <div class="glass w-full max-w-lg rounded-[32px] p-6 shadow-2xl max-h-[85vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-black flex items-center gap-2">
                <i class="fas fa-book-quran text-green-400"></i>Ù†ÙˆÛÚ˜ÛŒ Ø¬Û•Ù†Ø§Ø²Û•
            </h2>
            <button onclick="toggleModal('janazaModal')" class="w-10 h-10 rounded-xl glass-light flex items-center justify-center">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        
        <div class="space-y-4 text-sm">
            <!-- ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ ÛŒÛ•Ú©Û•Ù… -->
            <div class="glass-light p-5 rounded-2xl border-r-4 border-blue-500">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                        <span class="font-black text-white">Ù¡</span>
                    </div>
                    <h3 class="font-bold text-blue-400 prayer-kurdish">ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ ÛŒÛ•Ú©Û•Ù…</h3>
                    <span class="text-xs text-gray-400 mr-auto prayer-arabic" style="font-size: 16px;">Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±</span>
                </div>
                <p class="text-gray-300 mb-2 prayer-kurdish">Ø®ÙˆÛÙ†Ø¯Ù†ÛŒ Ø³ÙˆØ±Û•ØªÛŒ Ø§Ù„ÙØ§ØªØ­Ø© ÙˆÛ•Ú©Ùˆ Ù†ÙˆÛÚ˜ÛŒ Ø¦Ø§Ø¯Û•:</p>
                <p class="prayer-arabic text-blue-200 leading-loose text-justify pb-3 border-b border-blue-900/30">
                    Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù ï´¿Ù¡ï´¾ Ù±Ù„Û¡Ø­ÙÙ…Û¡Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ù±Ù„Û¡Ø¹ÙÙ€Ù°Ù„ÙÙ…ÙÙŠÙ†Ù ï´¿Ù¢ï´¾ Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù ï´¿Ù£ï´¾ Ù…ÙÙ€Ù°Ù„ÙÙƒÙ ÙŠÙÙˆÛ¡Ù…Ù Ù±Ù„Ø¯ÙÙ‘ÙŠÙ†Ù ï´¿Ù¤ï´¾ Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Û¡Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§Ú©Ù Ù†ÙØ³Û¡ØªÙØ¹ÙÙŠÙ†Ù ï´¿Ù¥ï´¾ Ù±Ù‡Û¡Ø¯ÙÙ†ÙØ§ Ù±Ù„ØµÙÙ‘Ø±ÙÙ°Ø·Ù Ù±Ù„Û¡Ù…ÙØ³Û¡ØªÙÙ‚ÙÙŠÙ…Ù ï´¿Ù¦ï´¾ ØµÙØ±ÙÙ°Ø·Ù Ù±Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Û¡Ø¹ÙÙ…Û¡ØªÙ Ø¹ÙÙ„ÙÙŠÛ¡Ù‡ÙÙ…Û¡ ØºÙÙŠÙ’Ø±Ù Ù±Ù„Û¡Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ù±Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù ï´¿Ù§ï´¾
                </p>
                <div class="mt-3 p-3 bg-blue-900/20 rounded-lg">
                    <p class="text-xs text-blue-300 prayer-kurdish"><i class="fas fa-info-circle ml-1"></i>Ù¾ÛØ´ ØªÛ•Ú©Ø¨ÛŒØ± Ø¯Û•ÚµÛÛŒØª: "Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±" Ùˆ Ø¦ÛŒÙ†Ø¬Ø§ Ø¦Û•Ù… Ø³ÙˆØ±Û•ØªÛ• Ø¯Û•Ø®ÙˆÛÙ†ÛŒØª.</p>
                </div>
            </div>

            <!-- ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø¯ÙˆÙˆÛ•Ù… -->
            <div class="glass-light p-5 rounded-2xl border-r-4 border-blue-500">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                        <span class="font-black text-white">Ù¢</span>
                    </div>
                    <h3 class="font-bold text-blue-400 prayer-kurdish">ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø¯ÙˆÙˆÛ•Ù…</h3>
                    <span class="text-xs text-gray-400 mr-auto prayer-arabic" style="font-size: 16px;">Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±</span>
                </div>
                <p class="text-gray-300 mb-2 prayer-kurdish">Ø®ÙˆÛÙ†Ø¯Ù†ÛŒ Ø³Û•ÚµØ§ÙˆØ§ØªÛŒ Ø¦ÛŒØ¨Ø±Ø§Ù‡ÛŒÙ…ÛŒ (Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Û•Ø³Û•Ø± Ù…Ø­Ù…Ø¯ ï·º):</p>
                <p class="prayer-arabic text-blue-200 leading-loose text-justify pb-3 border-b border-blue-900/30">
                    Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙØŒ ÙƒÙÙ…ÙØ§ ØµÙÙ„ÙÙ‘ÙŠÙ’ØªÙ Ø¹ÙÙ„ÙÙ‰ Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…ÙØŒ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø­ÙÙ…ÙÙŠØ¯ÙŒ Ù…ÙØ¬ÙÙŠØ¯ÙŒ<br>
                    Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙØ§Ø±ÙÙƒÙ’ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙØŒ ÙƒÙÙ…ÙØ§ Ø¨ÙØ§Ø±ÙÙƒÙ’ØªÙ Ø¹ÙÙ„ÙÙ‰ Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…ÙØŒ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø­ÙÙ…ÙÙŠØ¯ÙŒ Ù…ÙØ¬ÙÙŠØ¯ÙŒ
                </p>
                <div class="mt-3 p-3 bg-blue-900/20 rounded-lg">
                    <p class="text-xs text-blue-300 prayer-kurdish"><i class="fas fa-info-circle ml-1"></i>Ù¾ÛØ´ ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø¯ÙˆÙˆÛ•Ù…: "Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±" Ùˆ Ø¦ÛŒÙ†Ø¬Ø§ Ø¦Û•Ù… Ø³Û•ÚµØ§ÙˆØ§ØªÛ• Ø¯Û•Ø®ÙˆÛÙ†ÛŒØª.</p>
                </div>
            </div>

            <!-- ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø³ÛÛŒÛ•Ù… -->
            <div class="glass-light p-5 rounded-2xl border-r-4 border-green-500">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-lg">
                        <span class="font-black text-white">Ù£</span>
                    </div>
                    <h3 class="font-bold text-green-400 prayer-kurdish">ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø³ÛÛŒÛ•Ù…</h3>
                    <span class="text-xs text-gray-400 mr-auto prayer-arabic" style="font-size: 16px;">Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±</span>
                </div>
                <p class="text-gray-300 mb-2 prayer-kurdish">Ø¯ÙˆØ¹Ø§ÛŒ Ù…Ø±Ø¯ÙˆÙˆ (Ø¨Û† Ù¾ÛŒØ§Ùˆ):</p>
                <p class="prayer-arabic text-green-200 leading-loose text-justify pb-3 border-b border-green-900/30">
                    Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙ‡Ù ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙØŒ ÙˆÙØ¹ÙØ§ÙÙÙ‡Ù ÙˆÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†Ù’Ù‡ÙØŒ ÙˆÙØ£ÙÙƒÙ’Ø±ÙÙ…Ù’ Ù†ÙØ²ÙÙ„ÙÙ‡ÙØŒ ÙˆÙÙˆÙØ³ÙÙ‘Ø¹Ù’ Ù…ÙØ¯Ù’Ø®ÙÙ„ÙÙ‡ÙØŒ ÙˆÙØ§ØºÙ’Ø³ÙÙ„Ù’Ù‡Ù Ø¨ÙØ§Ù„Ù’Ù…ÙØ§Ø¡Ù ÙˆÙØ§Ù„Ø«ÙÙ‘Ù„Ù’Ø¬Ù ÙˆÙØ§Ù„Ù’Ø¨ÙØ±ÙØ¯ÙØŒ ÙˆÙÙ†ÙÙ‚ÙÙ‘Ù‡Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ø®ÙØ·ÙØ§ÙŠÙØ§ ÙƒÙÙ…ÙØ§ Ù†ÙÙ‚ÙÙ‘ÙŠÙ’ØªÙ Ø§Ù„Ø«ÙÙ‘ÙˆÙ’Ø¨Ù Ø§Ù„Ù’Ø£ÙØ¨Ù’ÙŠÙØ¶Ù Ù…ÙÙ†Ù Ø§Ù„Ø¯ÙÙ‘Ù†ÙØ³ÙØŒ ÙˆÙØ£ÙØ¨Ù’Ø¯ÙÙ„Ù’Ù‡Ù Ø¯ÙØ§Ø±Ù‹Ø§ Ø®ÙÙŠÙ’Ø±Ù‹Ø§ Ù…ÙÙ†Ù’ Ø¯ÙØ§Ø±ÙÙ‡ÙØŒ ÙˆÙØ£ÙÙ‡Ù’Ù„Ù‹Ø§ Ø®ÙÙŠÙ’Ø±Ù‹Ø§ Ù…ÙÙ†Ù’ Ø£ÙÙ‡Ù’Ù„ÙÙ‡ÙØŒ ÙˆÙØ²ÙÙˆÙ’Ø¬Ù‹Ø§ Ø®ÙÙŠÙ’Ø±Ù‹Ø§ Ù…ÙÙ†Ù’ Ø²ÙÙˆÙ’Ø¬ÙÙ‡ÙØŒ ÙˆÙØ£ÙØ¯Ù’Ø®ÙÙ„Ù’Ù‡Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©ÙØŒ ÙˆÙØ£ÙØ¹ÙØ°Ù’Ù‡Ù Ù…ÙÙ†Ù’ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù’Ù‚ÙØ¨Ù’Ø±Ù ÙˆÙØ¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù
                </p>
                
                <div class="mt-4 p-4 bg-green-900/20 rounded-lg">
                    <h4 class="font-bold text-green-300 text-sm mb-2 prayer-kurdish">Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ Ø¨Û† Ú˜Ù† Ùˆ Ù…Ù†Ø¯Ø§Úµ:</h4>
                    <ul class="text-xs text-green-200 space-y-2 prayer-kurdish">
                        <li class="flex items-start gap-2">
                            <span class="font-bold min-w-[50px]">Ø¨Û† Ú˜Ù†:</span>
                            <span class="prayer-arabic text-sm">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ <span class="text-yellow-300">Ù„ÙÙ‡ÙØ§</span> ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’<span class="text-yellow-300">Ù‡ÙØ§</span></span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="font-bold min-w-[50px]">Ø¨Û† Ù…Ù†Ø¯Ø§Úµ:</span>
                            <span class="prayer-arabic text-sm">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’Ù‡Ù ÙÙØ±ÙØ·Ù‹Ø§ Ù„ÙÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù‡Ù ÙˆÙØ³ÙØ¨ÙØ¨Ù‹Ø§ ÙÙÙŠ Ø´ÙÙÙØ§Ø¹ÙØªÙÙ‡ÙÙ…ÙØ§</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="font-bold min-w-[50px]">Ø¨Û† Ú©Û†Ù…Û•Úµ:</span>
                            <span class="prayer-arabic text-sm">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙ‡ÙÙ…Ù’ ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙÙ…Ù’</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ú†ÙˆØ§Ø±Û•Ù… -->
            <div class="glass-light p-5 rounded-2xl border-r-4 border-blue-500">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                        <span class="font-black text-white">Ù¤</span>
                    </div>
                    <h3 class="font-bold text-blue-400 prayer-kurdish">ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ú†ÙˆØ§Ø±Û•Ù…</h3>
                    <span class="text-xs text-gray-400 mr-auto prayer-arabic" style="font-size: 16px;">Ø§Ù„Ù„Ù‡ Ø£ÙÙƒÙ’Ø¨ÙØ±</span>
                </div>
                <p class="text-gray-300 mb-2 prayer-kurdish">Ø¯ÙˆØ¹Ø§ÛŒ Ú©Û†ØªØ§ÛŒÛŒ Ùˆ Ø³Û•Ù„Ø§Ù…:</p>
                <p class="prayer-arabic text-blue-200 leading-loose text-justify pb-3 border-b border-blue-900/30">
                    Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ§ ØªÙØ­Ù’Ø±ÙÙ…Ù’Ù†ÙØ§ Ø£ÙØ¬Ù’Ø±ÙÙ‡ÙØŒ ÙˆÙÙ„ÙØ§ ØªÙÙÙ’ØªÙÙ†ÙÙ‘Ø§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡ÙØŒ ÙˆÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙ†ÙØ§ ÙˆÙÙ„ÙÙ‡Ù
                </p>
                
                <div class="mt-4">
                    <h4 class="font-bold text-yellow-300 mb-2 prayer-kurdish">Ø³Û•Ù„Ø§Ù…Û•Ú©Û•:</h4>
                    <p class="prayer-arabic text-white text-center text-lg p-3 bg-white/5 rounded-xl">
                        Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ±ÙÙƒÙØ§ØªÙÙ‡Ù
                    </p>
                </div>
                
                <div class="mt-4 grid grid-cols-2 gap-3">
                    <div class="bg-blue-900/30 p-3 rounded-xl">
                        <h4 class="text-xs font-bold text-blue-300 mb-1 prayer-kurdish">Ø´ÛÙˆØ§Ø²ÛŒ ÛŒÛ•Ú©Û•Ù…:</h4>
                        <p class="text-[11px] text-gray-300 prayer-kurdish">Ø³Û•Ù„Ø§Ù… Ù„Û• Ú•Ø§Ø³ØªÛ•ÙˆÛ• ÛŒÛ•Ú© Ø¬Ø§Ø± Ø¯Û•Ø¯Û•ÛŒØªÛ•ÙˆÛ•</p>
                    </div>
                    <div class="bg-purple-900/30 p-3 rounded-xl">
                        <h4 class="text-xs font-bold text-purple-300 mb-1 prayer-kurdish">Ø´ÛÙˆØ§Ø²ÛŒ Ø¯ÙˆÙˆÛ•Ù…:</h4>
                        <p class="text-[11px] text-gray-300 prayer-kurdish">Ø³Û•Ù„Ø§Ù… Ù„Û• Ú•Ø§Ø³Øª Ùˆ Ú†Û•Ù¾Û•ÙˆÛ• Ø¯Û•Ø¯Û•ÛŒØªÛ•ÙˆÛ•</p>
                    </div>
                </div>
            </div>

            <!-- Ø¯ÙˆØ¹Ø§ Ùˆ ØªÛ•Ø³Ø¨ÛŒØ­ÛŒ Ú©Û†ØªØ§ÛŒÛŒ -->
            <div class="glass-light p-5 rounded-2xl border-r-4 border-purple-500">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg">
                        <i class="fas fa-hands-praying text-white"></i>
                    </div>
                    <h3 class="font-bold text-purple-400 prayer-kurdish">Ø¯ÙˆØ¹Ø§ Ùˆ ØªÛ•Ø³Ø¨ÛŒØ­ÛŒ Ø¯ÙˆØ§ÛŒ Ù†ÙˆÛÚ˜</h3>
                </div>
                
                <div class="space-y-3">
                    <div class="p-3 bg-purple-900/20 rounded-lg">
                        <h4 class="text-xs font-bold text-purple-300 mb-1 prayer-kurdish">Ø¯ÙˆØ¹Ø§ÛŒ Ú©Û†ØªØ§ÛŒÛŒ:</h4>
                        <p class="prayer-arabic text-purple-200 leading-relaxed">
                            Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ²ÙÙ‘Ø©Ù Ø¹ÙÙ…ÙÙ‘Ø§ ÙŠÙØµÙÙÙÙˆÙ†ÙØŒ ÙˆÙØ³ÙÙ„ÙØ§Ù…ÙŒ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ù…ÙØ±Ù’Ø³ÙÙ„ÙÙŠÙ†ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù
                        </p>
                    </div>
                    
                    <div class="p-3 bg-emerald-900/20 rounded-lg">
                        <h4 class="text-xs font-bold text-emerald-300 mb-1 prayer-kurdish">ØªÛ•Ø³Ø¨ÛŒØ­ÛŒ Ú•Ø§Ø³ØªÛ•Ù‚ÛŒÙ†Û•:</h4>
                        <div class="space-y-2 prayer-kurdish">
                            <div class="flex justify-between items-center">
                                <span class="text-emerald-200">Ù£Ù£ Ø¬Ø§Ø±:</span>
                                <span class="prayer-arabic text-emerald-300">Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-emerald-200">Ù£Ù£ Ø¬Ø§Ø±:</span>
                                <span class="prayer-arabic text-emerald-300">Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-emerald-200">Ù£Ù£ Ø¬Ø§Ø±:</span>
                                <span class="prayer-arabic text-emerald-300">Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù</span>
                            </div>
                            <div class="mt-2 pt-2 border-t border-emerald-800/30">
                                <span class="text-emerald-200 block mb-1">Ú©Û†ØªØ§ÛŒÛŒ:</span>
                                <span class="prayer-arabic text-emerald-300 text-sm">Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-amber-900/20 rounded-lg">
                        <h4 class="text-xs font-bold text-amber-300 mb-1 prayer-kurdish">Ø¯ÙˆØ¹Ø§ÛŒ Ø®ÛØ±:</h4>
                        <p class="prayer-arabic text-amber-200">
                            Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØ¬ÙØ±Ù’Ù†ÙÙŠ ÙÙÙŠ Ù…ÙØµÙÙŠØ¨ÙØªÙÙŠØŒ ÙˆÙØ§Ø®Ù’Ù„ÙÙÙ’ Ù„ÙÙŠ Ø®ÙÙŠÙ’Ø±Ù‹Ø§ Ù…ÙÙ†Ù’Ù‡ÙØ§
                        </p>
                    </div>
                </div>
            </div>

            <!-- ØªÛØ¨ÛŒÙ†ÛŒ Ùˆ ÙÛ•Ø±Ù…Ø§Ù†Û•Ú©Ø§Ù† -->
            <div class="glass-light p-4 rounded-2xl bg-gradient-to-r from-gray-900/50 to-gray-800/50 border border-gray-700">
                <h4 class="font-bold text-yellow-400 text-sm mb-3 flex items-center gap-2 prayer-kurdish">
                    <i class="fas fa-lightbulb"></i>ÙÛ•Ø±Ù…Ø§Ù† Ùˆ ØªÛØ¨ÛŒÙ†ÛŒÛ• Ú¯Ø±Ù†Ú¯Û•Ú©Ø§Ù†
                </h4>
                <ul class="text-xs text-gray-300 space-y-2 prayer-kurdish">
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ù†ÙˆÛÚ˜ÛŒ Ø¬Û•Ù†Ø§Ø²Û• <span class="text-yellow-300">Ú†ÙˆØ§Ø± ØªÛ•Ú©Ø¨ÛŒØ±</span> Ùˆ <span class="text-yellow-300">Ø³Û ØªÛ•Ú©Ø¨ÛŒØ±</span> Ù‡Û•ÛŒÛ•ØŒ Ø¦Û•Ù…Û• Ú†ÙˆØ§Ø± ØªÛ•Ú©Ø¨ÛŒØ±Û•.</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ù†ÙˆÛÚ˜ <span class="text-yellow-300">Ø¨Û•Ù‡Û•Ù…ÙˆÙˆ Ù‚ÙˆØ±Ø¦Ø§Ù†ÛÚ©</span> Ø¨Ú©Ø±ÛØª Ø¯Û•ØªÙˆØ§Ù†ÛŒØªØŒ ØªÛ•Ù†Ù‡Ø§ Ø³ÙˆÙˆØ±Û•ØªÛŒ ÙØ§ØªØ­Û• Ù„Û•Ø³Û•Ø± Ù‡Û•Ù…ÙˆÙˆØ§Ù† ÙˆØ§Ø¬Ø¨Û•.</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ø¦ÛŒÙ…Ø§Ù… Ù„Û• <span class="text-yellow-300">Ø³Û•Ø±ÛŒ Ù…Ø±Ø¯ÙˆÙˆ</span> Ø¯Ø§Ø¯Û•Ù†ÛŒØ´Øª (Ù¾ÛŒØ§Ùˆ Ù„Û• Ø³Û•Ø±ÛŒØŒ Ú˜Ù† Ù„Û• Ù†Ø§ÙˆÛ•Ú•Ø§Ø³ØªÛŒ).</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ù†ÙˆÛÚ˜ÛŒ Ø¬Û•Ù†Ø§Ø²Û• <span class="text-yellow-300">Ù„Û•Ø³Û•Ø± Ø²Û•ÙˆÛŒ Ù¾Ø§Ú©</span> ÛŒØ§Ù† Ù„Û•Ø³Û•Ø± Ø­Û•Ø³ÛŒØ± Ø¯Û•Ú©Ø±ÛØªØŒ Ù„Û• Ù†Ø§Ùˆ Ù…Ø²Ú¯Û•ÙˆØªØ¯Ø§ Ù†Ø§Ú©Ø±ÛØª.</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ø¦Û•Ú¯Û•Ø± <span class="text-yellow-300">Ù†Ø²ÛŒÚ©ØªØ±ÛŒÙ† Ø®Ø²Ù…</span> Ø¨ÛØªØŒ Ù„Û• Ù¾ÛØ´Û•ÙˆÛ•ÛŒ Ø¦ÛŒÙ…Ø§Ù… Ø¯Ø§Ø¯Û•Ù†ÛŒØ´Øª.</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-400 mt-0.5"></i>
                        <span>Ø¯ÙˆØ§ÛŒ ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆÙ†ÛŒ Ù†ÙˆÛÚ˜ØŒ <span class="text-yellow-300">Ù†Û•Ú©ÙˆØªØ±Ø§</span> Ùˆ Ø¯Û•Ø³Øª Ù…Û•Ú©ÛØ´Û• Ø¨Û•Ø³Û•Ø± Ù…Ø±Ø¯ÙˆÙˆØ¯Ø§.</span>
                    </li>
                </ul>
                
                <div class="mt-3 p-3 bg-black/40 rounded-lg">
                    <p class="text-xs text-center text-gray-400 prayer-kurdish">
                        <i class="fas fa-info-circle ml-1"></i>
                        Ø¦Û•Ù… Ø¯ÙˆØ¹Ø§ÛŒØ§Ù†Û• Ø¨Û•Ù¾ÛÛŒ Ø³ÙˆÙ†Ù†Û•ØªÛŒ Ù¾ÛØºÛ•Ù…Ø¨Û•Ø± ï·º Ùˆ ÙÛ•Ø±Ù…ÙˆÙˆØ¯Û•ÛŒ Ø¯Û•Ø³ØªÛ•ÚµØ§ØªØ¯Ø§Ø±Ø§Ù†Û•
                    </p>
                </div>
            </div>
        </div>
        
        <button onclick="toggleModal('janazaModal')" class="w-full mt-6 py-4 bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl font-bold shadow-lg hover:opacity-90 transition prayer-kurdish">
            <i class="fas fa-times-circle ml-1"></i>Ø¯Ø§Ø®Ø³ØªÙ†
        </button>
    </div>
</div>

<!-- Admin Modal -->
<div id="adminModal" class="modal-container" onclick="if(event.target==this) toggleModal('adminModal')">
    <div class="glass w-full max-w-lg rounded-[32px] p-6 shadow-2xl max-h-[85vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-black"><i class="fas fa-shield-alt text-blue-400 ml-2"></i>Ø¦Û•Ø¯Ù…ÛŒÙ†</h2>
            <button onclick="toggleModal('adminModal')" class="w-10 h-10 rounded-xl glass-light flex items-center justify-center">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>

        <!-- Admin Password -->
        <input type="password" id="adminPass" placeholder="ğŸ”’ Ú©Û†Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†" class="w-full glass-light p-4 rounded-2xl mb-4 outline-none border border-white/10 text-center font-bold placeholder-gray-500">

        <div class="glass-light p-2 rounded-2xl flex gap-2 mb-4">
            <button onclick="showAdminTab('funeral')" id="tabFuneral" class="flex-1 py-3 rounded-xl bg-red-600 font-bold text-sm">
                <i class="fas fa-hands-praying ml-1"></i>Ù¾Ø±Ø³Û•
            </button>
            <button onclick="showAdminTab('mosque')" id="tabMosque" class="flex-1 py-3 rounded-xl text-gray-400 font-bold text-sm">
                <i class="fas fa-mosque ml-1"></i>Ù…Ø²Ú¯Û•ÙˆØª
            </button>
            <button onclick="showAdminTab('edit')" id="tabEdit" class="flex-1 py-3 rounded-xl text-gray-400 font-bold text-sm">
                <i class="fas fa-edit ml-1"></i>Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ
            </button>
        </div>

        <!-- Funeral Form -->
        <div id="funeralForm" class="space-y-3">
            <div class="glass-light p-4 rounded-2xl">
                <h3 class="font-bold text-sm mb-3 text-red-400"><i class="fas fa-plus-circle ml-1"></i>Ù¾Ø±Ø³Û•ÛŒ Ù†ÙˆÛ</h3>
                <select id="mosqueSelect" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3"></select>
                <input id="deceasedName" placeholder="Ù†Ø§ÙˆÛŒ Ú©Û†Ú†Ú©Ø±Ø¯ÙˆÙˆ" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3">
                <input id="prayerTime" type="time" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3">
                <button onclick="submitFuneral()" class="w-full bg-red-600 py-4 rounded-2xl font-bold">
                    <i class="fas fa-paper-plane ml-1"></i>Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•
                </button>
            </div>
            <div class="glass-light p-4 rounded-2xl">
                <h3 class="text-sm font-bold text-red-400 mb-3"><i class="fas fa-list ml-1"></i>Ù¾Ø±Ø³Û• Ú†Ø§Ù„Ø§Ú©Û•Ú©Ø§Ù†</h3>
                <div id="adminFuneralList" class="space-y-2 max-h-48 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Mosque Add Form -->
        <div id="mosqueForm" class="hidden space-y-3">
            <div class="glass-light p-4 rounded-2xl">
                <h3 class="font-bold text-sm mb-3 text-green-400"><i class="fas fa-plus-circle ml-1"></i>Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù†ÙˆÛ</h3>
                <input id="mosqueName" placeholder="Ù†Ø§ÙˆÛŒ Ù…Ø²Ú¯Û•ÙˆØª" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3">
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <input id="mosqueLat" placeholder="Lat" class="bg-black/30 p-4 rounded-xl text-center text-xs outline-none border border-white/10">
                    <input id="mosqueLng" placeholder="Lng" class="bg-black/30 p-4 rounded-xl text-center text-xs outline-none border border-white/10">
                </div>
                <button onclick="useCurrentLocation()" class="w-full bg-blue-600 py-3 rounded-xl text-sm font-bold mb-3">
                    <i class="fas fa-crosshairs ml-1"></i>Ø´ÙˆÛÙ†ÛŒ Ø¦ÛØ³ØªØ§
                </button>
                <button onclick="submitMosque()" class="w-full bg-green-600 py-4 rounded-2xl font-bold">
                    <i class="fas fa-plus ml-1"></i>Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†
                </button>
            </div>
        </div>

        <!-- Edit Mosques Form -->
        <div id="editForm" class="hidden space-y-3">
            <div class="glass-light p-4 rounded-2xl">
                <h3 class="font-bold text-sm mb-3 text-blue-400"><i class="fas fa-edit ml-1"></i>Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ùˆ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù…Ø²Ú¯Û•ÙˆØª</h3>
                <p class="text-xs text-gray-400 mb-3">Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û• Ø¨Û† Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ ÛŒØ§Ù† Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</p>
                <select id="editMosqueSelect" onchange="loadMosqueForEdit()" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3">
                    <option value="">Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option>
                </select>
                
                <div id="editMosqueForm" class="hidden">
                    <input id="editMosqueName" placeholder="Ù†Ø§ÙˆÛŒ Ù†ÙˆÛÛŒ Ù…Ø²Ú¯Û•ÙˆØª" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3">
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <input id="editMosqueLat" placeholder="Lat" class="bg-black/30 p-4 rounded-xl text-center text-xs outline-none border border-white/10">
                        <input id="editMosqueLng" placeholder="Lng" class="bg-black/30 p-4 rounded-xl text-center text-xs outline-none border border-white/10">
                    </div>
                    <textarea id="editMosqueDesc" placeholder="Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ø²ÛŒØ§Ø¯Û• (Ø¦Ø§Ø±Û•Ø²ÙˆÙˆÙ…Û•Ù†Ø¯Ø§Ù†Û•)" class="w-full bg-black/30 p-4 rounded-xl outline-none border border-white/10 mb-3 text-sm min-h-[80px]"></textarea>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="updateMosque()" class="bg-blue-600 py-4 rounded-2xl font-bold">
                            <i class="fas fa-save ml-1"></i>Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•
                        </button>
                        <button onclick="deleteMosque()" class="bg-red-600 py-4 rounded-2xl font-bold">
                            <i class="fas fa-trash ml-1"></i>Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-blue-900/20 rounded-lg">
                    <h4 class="text-xs font-bold text-blue-300 mb-2">ØªÛØ¨ÛŒÙ†ÛŒ:</h4>
                    <ul class="text-xs text-gray-300 space-y-1">
                        <li>â€¢ ØªÛ•Ù†Ù‡Ø§ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ (Custom) Ø¯Û•ØªÙˆØ§Ù†Ø±ÛÙ† Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø¨Ú©Ø±ÛÙ†</li>
                        <li>â€¢ Ù…Ø²Ú¯Û•ÙˆØªÛ• Ø¨Ù†Û•Ú•Û•ØªÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§ Ù†Ø§ØªÙˆØ§Ù†Ø±ÛÙ† Ø³Ú•Ø¯Ø±ÛÙ†Û•ÙˆÛ•</li>
                        <li>â€¢ Ø´ÙˆÛÙ†ÛŒ Ù†Û•Ø®Ø´Û• Ú©Ù„ÛŒÚ© Ø¨Ú©Û• Ø¨Û† ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ù¾Û†ØªØ§Ù†Û•Ú©Ø§Ù†</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <button onclick="toggleModal('adminModal')" class="w-full mt-4 py-4 glass-light rounded-2xl font-bold">
            Ø¯Ø§Ø®Ø³ØªÙ†
        </button>
    </div>
</div>

<!-- Toast -->
<div id="toastNotif" class="toast-container">
    <div class="glass px-6 py-3 rounded-2xl flex items-center gap-3 shadow-2xl">
        <i id="toastIcon" class="fas fa-check-circle text-green-400 text-xl"></i>
        <span id="toastMessage" class="text-sm font-bold">Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ</span>
    </div>
</div>

<script>
    console.log("=== HAJIAWA ULTRA SUPREME v7.0 ===");
    console.log("ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ø³Ú©Ø±ÛŒÙ¾ØªÛ•Ú©Ø§Ù†...");

    // Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Leaflet
    if(typeof L === 'undefined') {
        console.error("âŒ Leaflet Ø¨Ø§Ø±Ù†Û•Ú©Ø±Ø§ÙˆÛ•!");
        document.getElementById('loadStatus').textContent = "Ú©ÛØ´Û• Ù„Û• Leaflet";
    } else {
        console.log("âœ… Leaflet Ø¨Ø§Ø±Ú©Ø±Ø§ÙˆÛ•");
    }

    // Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Firebase
    if(typeof firebase === 'undefined') {
        console.warn("âš ï¸ Firebase Ø¨Ø§Ø±Ù†Û•Ú©Ø±Ø§ÙˆÛ•ØŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ù…Û†Ø¯");
        document.getElementById('loadStatus').textContent = "Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ù…Û†Ø¯";
    } else {
        console.log("âœ… Firebase Ø¨Ø§Ø±Ú©Ø±Ø§ÙˆÛ•");
    }

    // Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Tailwind
    if(typeof tailwind === 'undefined') {
        console.warn("âš ï¸ Tailwind Ø¨Ø§Ø±Ù†Û•Ú©Ø±Ø§ÙˆÛ•");
    } else {
        console.log("âœ… Tailwind Ø¨Ø§Ø±Ú©Ø±Ø§ÙˆÛ•");
    }

    const firebaseConfig = {
        apiKey: "AIzaSyAoPWYvcDV875kkrU2Op7kSUV2GGmqdUkA",
        authDomain: "hajiawa-map-6fca6.firebaseapp.com",
        databaseURL: "https://hajiawa-map-6fca6-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "hajiawa-map-6fca6",
        storageBucket: "hajiawa-map-6fca6.firebasestorage.app",
        messagingSenderId: "631946456317",
        appId: "1:631946456317:web:3e08997a9ec6bd0865a294"
    };

    let map, db, userMarker, routingControl, currentTileLayer;
    let mosques = [];
    let funerals = {};
    let selectedMosque = null;
    let userPos = null;
    let prayerTimes = null;

    // Ù…Ø²Ú¯Û•ÙˆØªÛ• Ú•Ø§Ø³ØªÛ•Ù‚ÛŒÙ†Û•Ú©Ø§Ù†ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§ - ÙˆÛ•Ú© Ú©Û†Ø¯ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒÛŒ ØªÛ†
    const BACKUP_MOSQUES = [
        {id: "m1", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ú¯Û•ÙˆØ±Û•ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§", lat: 36.2369, lng: 44.7869, description: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ú¯Û•ÙˆØ±Û•ÛŒ Ø´Ø§Ø±"},
        {id: "m2", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ø´Û•Ú¾ÛŒØ¯Ø§Ù†", lat: 36.2355, lng: 44.7885},
        {id: "m3", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ø¯Ø§Ø¨Ø§Ù†", lat: 36.2340, lng: 44.7890},
        {id: "m4", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù…Ø§Ú©Û†Ú©", lat: 36.2335, lng: 44.7875},
        {id: "m5", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù‚Û•Ù„Ø§ÙˆÛ•ÛŒÛŒØ§Ù†", lat: 36.2320, lng: 44.7860},
        {id: "m12", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ø´Ø§ÙØ¹ÛŒ Ú¯Û•ÙˆØ±Û•", lat: 36.2410, lng: 44.7880},
        {id: "m21", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù†ÙˆØ±", lat: 36.2390, lng: 44.7820},
        {id: "m31", name: "Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ø³Û•Ù„Ø§Ø­Û•Ø¯ÛŒÙ†", lat: 36.2340, lng: 44.7850}
    ];

        // Ø¦Û•Ù… Ø¨Û•Ø´Û• Ø¨Ø®Û•Ø±Û• Ø´ÙˆÛÙ†ÛŒ window.addEventListener('load', ...) ÛŒ Ú©Û†Ù†Û•Ú©Û•
    window.addEventListener('load', async () => {
        console.log("ğŸš€ Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø³ÛŒØ³ØªÛ•Ù…...");

        // ÙÛ•Ø±Ù…Ø§Ù†ÛŒ Ù„Ø§Ø¨Ø±Ø¯Ù†ÛŒ Ø³Ù¾Ù„Ø§Ø´ Ø³Ú©Ø±ÛŒÙ† (Ø¨Û• Ø¬ÛŒØ§ Ø¯Û•ÛŒÙ†ÙˆØ³ÛŒÙ†)
        const removeSplash = () => {
            const splash = document.getElementById('splashScreen');
            if(splash) {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 700);
            }
        };

        // Ø³Û•Ù„Ø§Ù…Û•ØªÛŒ: Ø¯Ø§Ù†Ø§Ù†ÛŒ ØªØ§ÛŒÙ…Û•Ø±ÛÚ© Ú©Û• Ø¦Û•Ú¯Û•Ø± Ø¯ÙˆØ§ÛŒ Ù¥ Ú†Ø±Ú©Û• Ø¨Û•Ø±Ù†Ø§Ù…Û•Ú©Û• Ù†Û•Ú©Ø±Ø§ÛŒÛ•ÙˆÛ•ØŒ Ø¨Û• Ø²Û†Ø± Ø¨ÛŒÚ©Ø§ØªÛ•ÙˆÛ•
        // Ø¦Û•Ù…Û• Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ú©ÛØ´Û•Ú©Û•Øª Ø¯Û•Ú©Ø§Øª
        setTimeout(() => {
            console.log("âš ï¸ Ú©Ø§Øª ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆ (Safety Timeout) - Ù„Ø§Ø¨Ø±Ø¯Ù†ÛŒ Ø´Ø§Ø´Û• Ø¨Û• Ø²Û†Ø±");
            removeSplash();
        }, 5000);

        try {
            // Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¨Û† Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ† Ù„Û•ÙˆÛ•ÛŒ Ú©ØªÛØ¨Ø®Ø§Ù†Û•Ú©Ø§Ù† Ø¨Ø§Ø± Ø¨ÙˆÙˆÙ†
            if (typeof L === 'undefined') throw new Error("Ú©ØªÛØ¨Ø®Ø§Ù†Û•ÛŒ Ù†Û•Ø®Ø´Û• (Leaflet) Ø¨Ø§Ø± Ù†Û•Ø¨ÙˆÙˆÛ•");
            if (typeof adhan === 'undefined') console.warn("Ú©ØªÛØ¨Ø®Ø§Ù†Û•ÛŒ Ø¨Ø§Ù†Ú¯ (Adhan) Ø¨Ø§Ø± Ù†Û•Ø¨ÙˆÙˆÛ•");

            // Ù‡Û•ÙˆÚµØ¯Ø§Ù† Ø¨Û† Ú¯Ø±ÛØ¯Ø§Ù†ÛŒ ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³
            try {
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Firebase timeout')), 5000)
                );
                
                const firebasePromise = (async () => {
                    if (typeof firebase !== 'undefined') {
                        const app = firebase.initializeApp(firebaseConfig);
                        db = firebase.database();
                        console.log("âœ… Firebase Ú¯Ø±ÛØ¯Ø±Ø§ÙˆÛ•!");
                        updateLoadStatus("Ú¯Ø±ÛØ¯Ø±Ø§ÙˆÛ•...");
                    } else {
                        throw new Error("Firebase SDK Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•");
                    }
                })();
                
                await Promise.race([firebasePromise, timeoutPromise]);
            } catch(e) {
                console.warn("âš ï¸ Ú©ÛØ´Û• Ù„Û• ÙØ§ÛŒÛ•Ø±Ø¨Û•ÛŒØ³ ÛŒØ§Ù† Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª:", e.message);
                updateLoadStatus("Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ù…Û†Ø¯...");
                db = null; // Ú©Ø§Ø±Ú©Ø±Ø¯Ù† Ø¨Û• Ø¨Û Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³
                showToast("Ø³ÛŒØ³ØªÛ•Ù… Ù„Û• Ø¯Û†Ø®ÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ†Ø¯Ø§ÛŒÛ•", "error");
            }

            // Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ù†Û•Ø®Ø´Û•
            initMap();
            
            // Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§
            // Ù„ÛØ±Û• await Ø¨Û•Ú©Ø§Ø±Ù†Ø§Ù‡ÛÙ†ÛŒÙ† ØªØ§ Ù†Û•Ø¨ÛØªÛ• Ù‡Û†ÛŒ ÙˆÛ•Ø³ØªØ§Ù†ÛŒ Ø¨Û•Ø±Ù†Ø§Ù…Û•Ú©Û•
            loadMosques().catch(e => {
                console.error("âŒ Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†:", e);
                mosques = BACKUP_MOSQUES;
                renderMarkers();
                updateStats();
            });
            
            // Ø¦Û•Ú¯Û•Ø± Ú©ØªÛØ¨Ø®Ø§Ù†Û•ÛŒ Ø¨Ø§Ù†Ú¯ Ù‡Û•Ø¨ÙˆÙˆØŒ Ú©Ø§ØªÛ•Ú©Ø§Ù† Ù†ÙˆÛ Ø¨Ú©Û•Ø±Û•ÙˆÛ•
            if (typeof adhan !== 'undefined') {
                updatePrayerTimes();
                setInterval(updatePrayerTimes, 60000);
            }
            
            setInterval(updateCurrentTimeDisplay, 1000);
            autoDeleteOldFunerals();

            // Ù„Ø§Ø¨Ø±Ø¯Ù†ÛŒ Ø³Ù¾Ù„Ø§Ø´ Ø³Ú©Ø±ÛŒÙ† Ø¨Û• Ø´ÛÙˆÛ•ÛŒ Ø¦Ø§Ø³Ø§ÛŒÛŒ
            setTimeout(removeSplash, 1500);

        } catch (globalError) {
            console.error("âŒ Ù‡Û•ÚµÛ•ÛŒ Ú¯Û•ÙˆØ±Û• (Critical Error):", globalError);
            alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§: " + globalError.message + "\nØªÚ©Ø§ÛŒÛ• Ø¯ÚµÙ†ÛŒØ§Ø¨Û•Ø±Û•ÙˆÛ• Ù„Û• Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª.");
            // ØªÛ•Ù†Ø§Ù†Û•Øª Ø¦Û•Ú¯Û•Ø± Ù‡Û•ÚµÛ•Ø´ Ù‡Û•Ø¨ÛØªØŒ Ø³Ù¾Ù„Ø§Ø´Û•Ú©Û• Ù„Ø§Ø¨Ø¨Û• ØªØ§ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø´ØªÛÚ© Ø¨Ø¨ÛŒÙ†ÛØª
            removeSplash(); 
        }
    });


    function skipLoading() {
        console.log("ğŸ“‹ ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø´ØªÚ¯Ø±ÛØ¯Ø§Ù† Ø¯Û•Ú©Ø±ÛØª...");
        
        // Ù¾Û•Ù†Ø¬Û•Ù…Û• Ú©Ø±Ø¯Ù† Ù„Û• splash
        const splash = document.getElementById('splashScreen');
        splash.style.opacity = '0';
        
        // Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ù†Û•Ø®Ø´Û• Ø¨Û• Ú•ÛÚ©Ø®Ø³ØªÙ†ÛÚ©ÛŒ Ø³Ø§Ø¯Û•
        setTimeout(() => {
            splash.style.display = 'none';
            
            if(!map) {
                initMapSimple();
            }
            
            // Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø§Ù†ÛŒ Ù…Ø²Ú¯Û•ÙˆØªÛ• Ø¨Ù†Û•Ú•Û•ØªÛŒÛŒÛ•Ú©Ø§Ù†
            mosques = BACKUP_MOSQUES;
            renderMarkers();
            updateStats();
            
            showToast('Ø³ÛŒØ³ØªÛ•Ù… Ù„Û• Ù…Û†Ø¯ÛŒ ØªØ§Ù‚ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒÛ•', 'info');
        }, 500);
    }

    function initMapSimple() {
        try {
            map = L.map('map').setView([36.2369, 44.7869], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            showToast('Ù†Û•Ø®Ø´Û• Ø¨Ø§Ø±Ú©Ø±Ø§ (Ù…Û†Ø¯ÛŒ Ø³Ø§Ø¯Û•)', 'info');
        } catch(e) {
            console.error("âŒ Ù‡Û•ÚµÛ• Ù„Û• Ù…Û†Ø¯ÛŒ Ø³Ø§Ø¯Û•ÛŒ Ù†Û•Ø®Ø´Û•:", e);
            document.getElementById('map').innerHTML = 
                '<div class="p-4 text-center"><p class="text-red-400">Ù†Û•Ø®Ø´Û• Ø¨Ø§Ø±Ù†Û•Ú©Ø±Ø§</p><button onclick="location.reload()" class="mt-2 px-4 py-2 bg-blue-600 rounded">Ù‡Û•ÙˆÚµÛŒ Ø¯ÙˆÙˆØ¨Ø§Ø±Û•</button></div>';
        }
    }

    function updateLoadStatus(msg) {
        const el = document.getElementById('loadStatus');
        if(el) el.textContent = msg;
    }

    function initMap() {
        try {
            map = L.map('map', {
                zoomControl: false,
                attributionControl: false,
                minZoom: 12,
                maxZoom: 20
            }).setView([36.2369, 44.7869], 14);

            const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {maxZoom: 20});
            const satelliteLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {maxZoom: 20});
            const streetLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {maxZoom: 20});
            const terrainLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {maxZoom: 20});

            darkLayer.addTo(map);
            currentTileLayer = darkLayer;

            window.mapLayers = {dark: darkLayer, satellite: satelliteLayer, street: streetLayer, terrain: terrainLayer};
            
            map.locate({setView: true, maxZoom: 15});
            map.on('locationfound', (e) => {
                userPos = e.latlng;
                if(userMarker) map.removeLayer(userMarker);
                userMarker = L.marker(e.latlng, {
                    icon: L.divIcon({
                        className: 'bg-transparent',
                        html: '<div class="user-marker"></div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                }).addTo(map);
                updateNearbyCount();
            });

            map.on('locationerror', () => showToast('Ú©ÛØ´Û• Ù„Û• Ø´ÙˆÛÙ†', 'error'));
            map.on('click', (e) => {
                document.getElementById('mosqueLat').value = e.latlng.lat.toFixed(6);
                document.getElementById('mosqueLng').value = e.latlng.lng.toFixed(6);
                // Ø¨Û† Ø¨Û•Ø´ÛŒ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒØ´
                document.getElementById('editMosqueLat').value = e.latlng.lat.toFixed(6);
                document.getElementById('editMosqueLng').value = e.latlng.lng.toFixed(6);
            });
        } catch(e) {
            console.error("âŒ Ù‡Û•ÚµÛ• Ù„Û• Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ù†Û•Ø®Ø´Û•:", e);
            showToast('Ú©ÛØ´Û• Ù„Û• Ù†Û•Ø®Ø´Û•Ú©Û•', 'error');
            // Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ø¬Ø§Ø±ÛÚ©ÛŒ ØªØ± Ø¨Û• Ú•ÛÚ©Ø®Ø³ØªÙ†ÛÚ©ÛŒ Ø³Ø§Ø¯Û•ØªØ±
            setTimeout(initMapSimple, 1000);
        }
    }

    function changeMapStyle(style) {
        if(currentTileLayer) map.removeLayer(currentTileLayer);
        const layer = window.mapLayers[style];
        if(layer) {
            layer.addTo(map);
            currentTileLayer = layer;
            showToast(`Ú¯Û†Ú•Ø¯Ø±Ø§ Ø¨Û† ${style}`);
        }
        toggleMapStyleMenu();
    }

    function toggleMapStyleMenu() {
        const menu = document.getElementById('mapStyleMenu');
        menu.classList.toggle('hidden');
    }

    async function loadMosques() {
        console.log("ğŸš€ Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†...");
        
        // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ timeout Ø¨Û† OSM
        const timeoutDuration = 15000; // 15 Ú†Ø±Ú©Û•
        
        try {
            // Fetch from OSM Ø¨Û• timeout
            const query = `[out:json];node["amenity"="place_of_worship"]["religion"="muslim"](36.21,44.75,36.26,44.83);out;`;
            let osmMosques = [];
            
            const osmPromise = fetch('https://overpass-api.de/api/interpreter', {
                method: 'POST', 
                body: query
            }).then(res => res.json())
              .then(data => {
                osmMosques = data.elements.map(e => ({
                    id: 'osm_' + e.id,
                    name: e.tags['name:ckb'] || e.tags.name || 'Ù…Ø²Ú¯Û•ÙˆØª',
                    lat: e.lat,
                    lng: e.lon
                }));
                console.log(`âœ… ${osmMosques.length} Ù…Ø²Ú¯Û•ÙˆØª Ù„Û• OSM Ù‡ÛÙ†Ø±Ø§`);
                return osmMosques;
            }).catch(e => {
                console.warn("âš ï¸ OSM Ú©Ø§Ø± Ù†Û•Ú©Ø±Ø¯:", e);
                return [];
            });
            
            // Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒ Ø¨Û† OSM
            osmMosques = await Promise.race([
                osmPromise,
                new Promise(resolve => setTimeout(() => {
                    console.log("â±ï¸ OSM timeout");
                    resolve([]);
                }, timeoutDuration))
            ]);

            // Firebase
            if(db) {
                console.log("ğŸ”¥ Firebase Ø¨Û•Ø±Ø¯Û•Ø³ØªÛ•ØŒ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù† Ø¨Ø§Ø± Ø¯Û•Ú©Ø±ÛÙ†...");
                
                // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ callback Ø¨Û† Ù‡Û•ÚµÛ•
                db.ref('customMosques').on('value', (snap) => {
                    try {
                        const custom = snap.val() ? Object.values(snap.val()) : [];
                        const all = [...BACKUP_MOSQUES, ...osmMosques, ...custom];
                        mosques = all.filter((m, i, a) => a.findIndex(t => t.id === m.id) === i);
                        console.log(`ğŸ¯ Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: ${mosques.length} Ù…Ø²Ú¯Û•ÙˆØª`);
                        renderMarkers();
                        updateAdminSelect();
                        updateEditMosqueSelect();
                        updateStats();
                    } catch(e) {
                        console.error("âŒ Ù‡Û•ÚµÛ• Ù„Û• Firebase customMosques:", e);
                        mosques = [...BACKUP_MOSQUES, ...osmMosques];
                        renderMarkers();
                        updateStats();
                    }
                }, (error) => {
                    console.error("âŒ Ù‡Û•ÚµÛ•ÛŒ Firebase:", error);
                    mosques = [...BACKUP_MOSQUES, ...osmMosques];
                    renderMarkers();
                    updateStats();
                });

                db.ref('funerals').on('value', (snap) => {
                    funerals = snap.val() || {};
                    console.log(`âš°ï¸ ${Object.keys(funerals).length} Ù¾Ø±Ø³Û• Ú†Ø§Ù„Ø§Ú©`);
                    renderMarkers();
                    updateStats();
                    updateHeaderBadge();
                    updateAdminFuneralList();
                });
                
            } else {
                console.log("ğŸ“´ Firebase Ù†ÛŒÛŒÛ•ØŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ø¯Û•Ú•Û†ÛŒÙ†");
                mosques = [...BACKUP_MOSQUES, ...osmMosques];
                console.log(`ğŸ“± Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ (Ø¦Û†ÙÙ„Ø§ÛŒÙ†): ${mosques.length} Ù…Ø²Ú¯Û•ÙˆØª`);
                renderMarkers();
                updateAdminSelect();
                updateEditMosqueSelect();
                updateStats();
            }
            
        } catch(e) {
            console.error("âŒ Ù‡Û•ÚµÛ•ÛŒ Ú¯Ø´ØªÛŒ Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†:", e);
            mosques = BACKUP_MOSQUES;
            renderMarkers();
            updateStats();
            throw e; // Ù‡Û•ÚµÛ•Ú©Û• Ø¯Û•Ø±Ø¨Ø§Ø² Ø¨Ú©Û• Ø¨Û† catch ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ
        }
    }

    function renderMarkers() {
        map.eachLayer(l => {
            if(l instanceof L.Marker && l !== userMarker) map.removeLayer(l);
        });

        mosques.forEach(m => {
            const hasFun = funerals[m.id];
            const icon = L.divIcon({
                className: 'bg-transparent',
                html: hasFun ? '<div class="marker-funeral"><i class="fas fa-hands-praying"></i></div>' : '<div class="marker-mosque"><i class="fas fa-moon"></i></div>',
                iconSize: hasFun ? [52,52] : [40,40],
                iconAnchor: hasFun ? [26,52] : [20,20]
            });
            L.marker([m.lat, m.lng], {icon}).addTo(map).on('click', () => openDetailCard(m, hasFun));
        });
    }

    function openDetailCard(m, fun) {
        selectedMosque = m;
        document.getElementById('cardTitle').textContent = m.name;
        
        const iconDiv = document.getElementById('cardIcon');
        if(fun) {
            iconDiv.className = 'relative w-20 h-20 bg-gradient-to-br from-red-500 to-red-600 rounded-full border-4 border-ultra-dark flex items-center justify-center shadow-2xl';
            iconDiv.innerHTML = '<i class="fas fa-hands-praying text-3xl text-white"></i>';
        } else {
            iconDiv.className = 'relative w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full border-4 border-ultra-dark flex items-center justify-center shadow-2xl';
            iconDiv.innerHTML = '<i class="fas fa-mosque text-3xl text-white"></i>';
        }

        if(userPos) {
            const dist = (map.distance(userPos, [m.lat, m.lng]) / 1000).toFixed(1);
            document.getElementById('cardDistText').textContent = dist + ' km';
            document.getElementById('cardDistance').classList.remove('hidden');
        } else {
            document.getElementById('cardDistance').classList.add('hidden');
        }

        const detDiv = document.getElementById('cardDetails');
        if(m.description) {
            detDiv.classList.remove('hidden');
            document.getElementById('cardDescription').textContent = m.description;
        } else {
            detDiv.classList.add('hidden');
        }

        const alert = document.getElementById('cardFuneralAlert');
        if(fun) {
            alert.classList.remove('hidden');
            document.getElementById('cardDeadName').textContent = fun.name;
            document.getElementById('cardPrayerTime').textContent = 'Ú©Ø§Øª: ' + fun.time;
        } else {
            alert.classList.add('hidden');
        }

        document.getElementById('detailCard').style.transform = 'translateY(0)';
        map.flyTo([m.lat, m.lng], 16, {duration: 1.2});
    }

    function closeCard() {
        document.getElementById('detailCard').style.transform = 'translateY(100%)';
        if(routingControl) {
            map.removeControl(routingControl);
            routingControl = null;
        }
    }

    function startNavigation() {
        if(!userPos) return showToast('Ø´ÙˆÛÙ† Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'error');
        if(!selectedMosque) return showToast('Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•', 'error');
        
        closeCard();
        if(routingControl) map.removeControl(routingControl);
        
        routingControl = L.Routing.control({
            waypoints: [L.latLng(userPos.lat, userPos.lng), L.latLng(selectedMosque.lat, selectedMosque.lng)],
            lineOptions: {styles: [{color: '#3b82f6', opacity: 0.9, weight: 6}]},
            createMarker: () => null,
            show: false
        }).addTo(map);
        
        showToast('Ú•ÛÚ¯Ø§Ú©ÛØ´Ø§Ù† Ø¯Û•Ø³ØªÛŒ Ù¾ÛÚ©Ø±Ø¯');
    }

    function handleSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase().trim();
        if(q.length < 2) return;
        const found = mosques.find(m => m.name.toLowerCase().includes(q));
        if(found) {
            map.flyTo([found.lat, found.lng], 17);
            setTimeout(() => openDetailCard(found, funerals[found.id]), 1500);
        } else {
            showToast('Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'error');
        }
    }

    function clearSearch() {
        document.getElementById('searchInput').value = '';
    }

    function updatePrayerTimes() {
        // 1. Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ø´ÙˆÛÙ† Ø¨Û† Ø­Ø§Ø¬ÛŒØ§ÙˆØ§
        const coordinates = new adhan.Coordinates(36.2234, 44.8166);
        const date = new Date();
        
        // 2. Ù…ÛŒØªÛ†Ø¯ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù† Ø¨Û† Ø¹ÛØ±Ø§Ù‚
        const params = adhan.CalculationMethod.MuslimWorldLeague();
        params.madhab = adhan.Madhab.Shafi; // Ù…Û•Ø²Ù‡Û•Ø¨ÛŒ Ø´Ø§ÙÛŒØ¹ÛŒ
        
        // 3. Ø¦ÛŒØ­ØªÛŒØ§ØªÛ•Ú©Ø§Ù† Ø¨Û† ÙˆØ±Ø¯Ø¨ÛŒÙ†ÛŒ (Adjustments)
        params.adjustments.fajr = 2;      // +2 Ø®ÙˆÙ„Û•Ú©
        params.adjustments.dhuhr = 1;     // +1 Ø®ÙˆÙ„Û•Ú©
        params.adjustments.asr = 1;       // +1 Ø®ÙˆÙ„Û•Ú©
        params.adjustments.maghrib = 2;   // +2 Ø®ÙˆÙ„Û•Ú©
        params.adjustments.isha = 1;      // +1 Ø®ÙˆÙ„Û•Ú©
        
        // 4. ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ú©Ø§ØªÛ•Ú©Ø§Ù†
        const prayerTimes = new adhan.PrayerTimes(coordinates, date, params);
        
        // 5. ÙÛ†Ø±Ù…Ø§ØªÚ©Ø±Ø¯Ù†ÛŒ Ú©Ø§Øª
        function formatPrayerTime(time) {
            let hours = time.getHours();
            let minutes = time.getMinutes();
            minutes = minutes < 10 ? '0' + minutes : minutes;
            return `${hours}:${minutes}`;
        }
        
        // 6. Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†Û•Ú©Ø§Ù† Ø¨Û• Ú©ÙˆØ±Ø¯ÛŒ
        const prayerSchedule = [
            {name: 'Ø¨Û•ÛŒØ§Ù†ÛŒ', key: 'fajr', time: formatPrayerTime(prayerTimes.fajr), icon: 'fa-moon', arabic: 'Ø§Ù„ÙØ¬Ø±'},
            {name: 'Ø®Û†Ø±Ù‡Û•ÚµØ§ØªÙ†', key: 'sunrise', time: formatPrayerTime(prayerTimes.sunrise), icon: 'fa-sun', arabic: 'Ø§Ù„Ø´Ø±ÙˆÙ‚'},
            {name: 'Ù†ÛŒÙˆÛ•Ú•Û†', key: 'dhuhr', time: formatPrayerTime(prayerTimes.dhuhr), icon: 'fa-cloud-sun', arabic: 'Ø§Ù„Ø¸Ù‡Ø±'},
            {name: 'Ø¹Û•Ø³Ø±', key: 'asr', time: formatPrayerTime(prayerTimes.asr), icon: 'fa-cloud', arabic: 'Ø§Ù„Ø¹ØµØ±'},
            {name: 'Ù…Û•ØºØ±ÛŒØ¨', key: 'maghrib', time: formatPrayerTime(prayerTimes.maghrib), icon: 'fa-sunset', arabic: 'Ø§Ù„Ù…ØºØ±Ø¨'},
            {name: 'Ø¹ÛŒØ´Ø§', key: 'isha', time: formatPrayerTime(prayerTimes.isha), icon: 'fa-moon-stars', arabic: 'Ø§Ù„Ø¹Ø´Ø§Ø¡'}
        ];
        
        // 7. Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù† Ù„Û• HTML
        const list = document.getElementById('prayerList');
        list.innerHTML = '';
        
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        
        // Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú©Ø§Ù… Ù†ÙˆÛÚ˜ Ø¦ÛØ³ØªØ§ÛŒÛ• Ùˆ Ú©Ø§Ù…ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆÛ•
        let currentPrayerIndex = -1;
        let nextPrayerIndex = -1;
        
        prayerSchedule.forEach((prayer, index) => {
            const [hours, minutes] = prayer.time.split(':').map(Number);
            const prayerMinutes = hours * 60 + minutes;
            
            if (prayerMinutes <= currentMinutes) {
                currentPrayerIndex = index;
            } else if (nextPrayerIndex === -1 && prayerMinutes > currentMinutes) {
                nextPrayerIndex = index;
            }
        });
        
        // Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù„ÛŒØ³Øª
        prayerSchedule.forEach((prayer, index) => {
            const [hours, minutes] = prayer.time.split(':').map(Number);
            const prayerMinutes = hours * 60 + minutes;
            const isCurrent = index === currentPrayerIndex;
            const isNext = index === nextPrayerIndex;
            
            // Ú©Ø§ØªÛŒ Ù…Ø§ÙˆÛ•
            let timeRemaining = '';
            if (prayerMinutes > currentMinutes) {
                const remaining = prayerMinutes - currentMinutes;
                const hoursRemaining = Math.floor(remaining / 60);
                const minutesRemaining = remaining % 60;
                timeRemaining = `${hoursRemaining > 0 ? hoursRemaining + 'Ú©' : ''}${minutesRemaining}Ø®`;
            } else if (prayerMinutes < currentMinutes) {
                timeRemaining = 'ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆ';
            }
            
            // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ 30 Ø®ÙˆÙ„Û•Ú© Ø¨Û† Ù†ÛŒÙˆÛ•Ú•Û†ÛŒ Ù‡Û•ÛŒÙ†ÛŒ
            let displayTime = prayer.time;
            if (prayer.key === 'dhuhr' && now.getDay() === 5) { // Ù‡Û•ÛŒÙ†ÛŒ
                const h = parseInt(prayer.time.split(':')[0]);
                const m = parseInt(prayer.time.split(':')[1]) + 30;
                const newHours = h + Math.floor(m / 60);
                const newMinutes = m % 60;
                displayTime = `${newHours}:${newMinutes < 10 ? '0' : ''}${newMinutes}`;
            }
            
            list.innerHTML += `
                <div class="flex justify-between items-center p-4 rounded-2xl ${isCurrent ? 'bg-gradient-to-r from-blue-600/30 to-blue-800/30 border-2 border-blue-500/40' : isNext ? 'prayer-next' : 'glass-light'} transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-11 h-11 rounded-xl bg-gradient-to-br ${isCurrent ? 'from-blue-500 to-purple-500' : isNext ? 'from-blue-500/40 to-purple-500/40' : 'from-white/10 to-white/5'} flex items-center justify-center shadow-lg">
                            <i class="fas ${prayer.icon} ${isCurrent ? 'text-white' : isNext ? 'text-blue-300' : 'text-gray-400'}"></i>
                        </div>
                        <div>
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-sm ${isCurrent ? 'text-white' : isNext ? 'text-blue-200' : 'text-gray-300'}">${prayer.name}</span>
                                ${isCurrent ? '<span class="text-xs bg-blue-500/30 px-2 py-0.5 rounded-lg text-blue-200">Ø¦ÛØ³ØªØ§</span>' : ''}
                                ${isNext ? '<span class="text-xs bg-blue-500/40 px-2 py-0.5 rounded-lg text-blue-200">Ø¯Ø§Ù‡Ø§ØªÙˆÙˆ</span>' : ''}
                            </div>
                            <span class="block text-[10px] ${isCurrent ? 'text-blue-300' : isNext ? 'text-blue-400' : 'text-gray-500'} mt-0.5">${prayer.arabic}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="font-mono text-lg font-bold ${isCurrent ? 'text-blue-200' : isNext ? 'text-blue-100' : 'text-gray-400'} block">${displayTime}</span>
                        <span class="text-xs ${isCurrent ? 'text-blue-400' : isNext ? 'text-blue-300' : 'text-gray-500'} font-mono">${timeRemaining}</span>
                    </div>
                </div>
            `;
        });
        
        // 8. Ù†ÙˆÛÚ˜Û•Ú©Ø§Ù†ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆ Ù†ÛŒØ´Ø§Ù† Ø¨Ø¯Û• Ù„Û• Ø³Û•Ø±Û•ÙˆÛ•
        if (nextPrayerIndex !== -1) {
            const nextPrayer = prayerSchedule[nextPrayerIndex];
            document.getElementById('prayerNotif').textContent = nextPrayer.name;
            document.getElementById('prayerNotif').classList.remove('hidden');
            
            // ØªØ§ÛŒÙ…Û•Ø± Ø¨Û† Ù†ÙˆÛÚ˜ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆ
            const [nextHours, nextMinutes] = nextPrayer.time.split(':').map(Number);
            const nextPrayerMinutes = nextHours * 60 + nextMinutes;
            const remainingMinutes = nextPrayerMinutes - currentMinutes;
            
            // Ø¦Û•Ú¯Û•Ø± Ù‡Û•ÛŒÙ†ÛŒÛ• Ùˆ Ù†ÙˆÛÚ˜ÛŒ Ù†ÛŒÙˆÛ•Ú•Û† Ø¯Ø§Ù‡Ø§ØªÙˆÙˆÛ•
            if (nextPrayer.key === 'dhuhr' && now.getDay() === 5) {
                document.getElementById('prayerNotif').textContent = 'Ù†ÛŒÙˆÛ•Ú•Û† (Ù‡Û•ÛŒÙ†ÛŒ)';
            }
        } else {
            // Ø¦Û•Ú¯Û•Ø± Ù‡Û•Ù…ÙˆÙˆ Ù†ÙˆÛÚ˜Û•Ú©Ø§Ù† ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆÙ†ØŒ Ù†ÙˆÛÚ˜ÛŒ Ø¨Û•ÛŒØ§Ù†ÛŒ Ø¯Û•Ø³ØªÙ¾ÛØ¯Û•Ú©Û•
            document.getElementById('prayerNotif').textContent = 'Ø¨Û•ÛŒØ§Ù†ÛŒ';
            document.getElementById('prayerNotif').classList.remove('hidden');
        }
        
        // 9. Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ØªÛØ¨ÛŒÙ†ÛŒ Ø¨Û† Ø­Ø§Ø¬ÛŒØ§ÙˆØ§
        const notes = [
            "Ú©Ø§ØªÛ•Ú©Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ù…ÛŒØªÛ†Ø¯ÛŒ Ø¬ÛŒÙ‡Ø§Ù†ÛŒ Ø¦ÛŒØ³Ù„Ø§Ù…ÛŒ Ùˆ Ù…Û•Ø²Ù‡Û•Ø¨ÛŒ Ø´Ø§ÙØ¹ÛŒÛ•",
            "Ú©Ø§ØªÛŒ Ø¹Û•Ø³Ø± Ø¨Û•Ù¾ÛÛŒ Ø´Û•ÙÛ•ÛŒ Ø¦ÛŒÙ…Ø§Ù… Ø´Ø§ÙØ¹ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø± Ú©Ø±Ø§ÙˆÛ•",
            "Ù„Û• Ù…Ø§Ù†Ú¯Û•Ú©Ø§Ù†Ø¯Ø§ Ú©Ø§ØªÛ•Ú©Ø§Ù† Â±Ù¡Ù  Ø®ÙˆÙ„Û•Ú© Ø¯Û•Ú¯Û†Ú•ÛÙ†",
            "Ú©Ø§ØªÛŒ Ù…Û•ØºØ±ÛŒØ¨ Ù¢ Ø®ÙˆÙ„Û•Ú© Ø¯ÙˆØ§ÛŒ Ø¦Ø§ÙˆÛ•Ø¯Ø§Ù† Ø¨ÙˆÙˆÙ†ÛŒ Ø®Û†Ø±Û•",
            "Ù†ÙˆÛÚ˜ÛŒ Ù‡Û•ÛŒÙ†ÛŒ Ù„Û• Ø­Ø§Ø¬ÛŒØ§ÙˆØ§ Ù£Ù  Ø®ÙˆÙ„Û•Ú© Ø¯ÙˆØ§ØªØ±Û•"
        ];
        const noteText = notes[Math.floor(Math.random() * notes.length)];
        
        const note = document.createElement('div');
        note.className = 'mt-4 p-3 bg-blue-900/20 rounded-xl border border-blue-800/30';
        note.innerHTML = `
            <p class="text-xs text-blue-300 text-center prayer-kurdish">
                <i class="fas fa-map-marker-alt ml-1"></i>
                ${noteText}
            </p>
        `;
        list.appendChild(note);
        
        updateCurrentTimeDisplay();
    }

    function updateCurrentTimeDisplay() {
        const now = new Date();
        
        // Ù†Ø§ÙˆÛŒ Ù…Ø§Ù†Ú¯Û•Ú©Ø§Ù† Ø¨Û• Ú©ÙˆØ±Ø¯ÛŒ
        const kurdishMonths = [
            'Ú©Ø§Ù†ÙˆÙˆÙ†ÛŒ Ø¯ÙˆÙˆÛ•Ù…', 'Ø´ÙˆØ¨Ø§Øª', 'Ø¦Ø§Ø²Ø§Ø±', 'Ù†ÛŒØ³Ø§Ù†', 
            'Ø¦Ø§ÛŒØ§Ø±', 'Ø­ÙˆØ²Û•ÛŒØ±Ø§Ù†', 'ØªÛ•Ù…Ù…ÙˆÙˆØ²', 'Ø¦Ø§Ø¨', 
            'Ø¦Û•ÛŒÙ„ÙˆÙˆÙ„', 'ØªØ´Ø±ÛŒÙ†ÛŒ ÛŒÛ•Ú©Û•Ù…', 'ØªØ´Ø±ÛŒÙ†ÛŒ Ø¯ÙˆÙˆÛ•Ù…', 'Ú©Ø§Ù†ÙˆÙˆÙ†ÛŒ ÛŒÛ•Ú©Û•Ù…'
        ];
        
        // Ù†Ø§ÙˆÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù† Ø¨Û• Ú©ÙˆØ±Ø¯ÛŒ
        const kurdishDays = [
            'ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•', 'Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û•', 'Ø³ÛØ´Û•Ù…Ù…Û•', 'Ú†ÙˆØ§Ø±Ø´Û•Ù…Ù…Û•', 
            'Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û•', 'Ù‡Û•ÛŒÙ†ÛŒ', 'Ø´Û•Ù…Ù…Û•'
        ];
        
        // Ú©Ø§Øª Ø¨Û• Ø´ÛÙˆØ§Ø²ÛŒ 24 Ø³Û•Ø¹Ø§ØªÛŒ
        const time24 = now.toLocaleTimeString('en-US', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        // Ú©Ø§Øª Ø¨Û• Ø´ÛÙˆØ§Ø²ÛŒ 12 Ø³Û•Ø¹Ø§ØªÛŒ Ø¨Û† Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†
        const time12 = now.toLocaleTimeString('ckb-IQ', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        const dayName = kurdishDays[now.getDay()];
        const monthName = kurdishMonths[now.getMonth()];
        const year = now.getFullYear();
        const day = now.getDate();
        
        const dateString = `${dayName}ØŒ ${day} ${monthName} ${year}`;
        
        const el = document.getElementById('currentTime');
        if(el) {
            el.innerHTML = `
                <div class="flex flex-col items-center gap-1">
                    <div class="text-2xl font-mono font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">${time24}</div>
                    <div class="text-sm text-gray-400 mt-1">${time12}</div>
                    <div class="text-xs text-gray-500 mt-2 border-t border-white/10 pt-2 w-full">${dateString}</div>
                </div>
            `;
        }
    }

    function updateStats() {
        document.getElementById('totalMosques').textContent = mosques.length;
        document.getElementById('activeFunerals').textContent = Object.keys(funerals).length;
        updateNearbyCount();
        updateTodayFuneralsList();
    }

    function updateNearbyCount() {
        if(!userPos) {
            document.getElementById('nearbyCount').textContent = '0';
            return;
        }
        const nearby = mosques.filter(m => map.distance(userPos, [m.lat, m.lng]) <= 2000);
        document.getElementById('nearbyCount').textContent = nearby.length;
    }

    function updateTodayFuneralsList() {
        const list = document.getElementById('todayFuneralsList');
        list.innerHTML = '';
        const count = Object.keys(funerals).length;
        if(count === 0) {
            list.innerHTML = '<p class="text-center text-gray-500 text-sm py-3">Ù‡ÛŒÚ† Ù¾Ø±Ø³Û•ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</p>';
            return;
        }
        Object.entries(funerals).forEach(([id, data]) => {
            const m = mosques.find(x => x.id == id);
            if(!m) return;
            const div = document.createElement('div');
            div.className = 'glass-light p-3 rounded-xl flex justify-between';
            div.innerHTML = `<div><p class="text-xs font-bold text-white">${m.name}</p><p class="text-xs text-gray-400">${data.name}</p></div><span class="text-xs text-blue-400 font-mono">${data.time}</span>`;
            list.appendChild(div);
        });
    }

    function updateHeaderBadge() {
        const count = Object.keys(funerals).length;
        const badge = document.getElementById('funeralBadge');
        if(count > 0) {
            badge.classList.remove('hidden');
            badge.classList.add('flex');
            document.getElementById('funeralCount').textContent = count + ' Ù¾Ø±Ø³Û•';
            document.getElementById('statsNotif').classList.remove('hidden');
        } else {
            badge.classList.add('hidden');
            document.getElementById('statsNotif').classList.add('hidden');
        }
    }

    function showAllMosques() {
        if(mosques.length === 0) return showToast('Ù‡ÛŒÚ† Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù†ÛŒÛŒÛ•', 'error');
        const bounds = L.latLngBounds();
        mosques.forEach(m => bounds.extend([m.lat, m.lng]));
        map.fitBounds(bounds, {padding: [50, 50]});
        showToast(`${mosques.length} Ù…Ø²Ú¯Û•ÙˆØª`);
    }

    function showAdminTab(tab) {
        const ff = document.getElementById('funeralForm');
        const mf = document.getElementById('mosqueForm');
        const ef = document.getElementById('editForm');
        const tf = document.getElementById('tabFuneral');
        const tm = document.getElementById('tabMosque');
        const te = document.getElementById('tabEdit');
        
        // Ù‡Û•Ù…ÙˆÙˆ ØªØ§Ø¨ÛŒÛ•Ú©Ø§Ù† Ø¨Ø´Ø§Ø±Û•ÙˆÛ•
        ff.classList.add('hidden');
        mf.classList.add('hidden');
        ef.classList.add('hidden');
        
        // Ù‡Û•Ù…ÙˆÙˆ ØªØ§Ø¨Û•Ú©Ø§Ù† Ø¨ÛŒÚ©Û• Ø¨Û• Ù†Ø§Ú†Ø§Ù„Ø§Ú©
        tf.className = 'flex-1 py-3 rounded-xl text-gray-400 font-bold text-sm';
        tm.className = 'flex-1 py-3 rounded-xl text-gray-400 font-bold text-sm';
        te.className = 'flex-1 py-3 rounded-xl text-gray-400 font-bold text-sm';
        
        if(tab === 'funeral') {
            ff.classList.remove('hidden');
            tf.className = 'flex-1 py-3 rounded-xl bg-red-600 font-bold text-sm';
        } else if(tab === 'mosque') {
            mf.classList.remove('hidden');
            tm.className = 'flex-1 py-3 rounded-xl bg-green-600 font-bold text-sm';
        } else if(tab === 'edit') {
            ef.classList.remove('hidden');
            te.className = 'flex-1 py-3 rounded-xl bg-blue-600 font-bold text-sm';
            updateEditMosqueSelect();
        }
    }

    function submitFuneral() {
        const pass = document.getElementById('adminPass').value;
        if(pass !== '2026') return showToast('Ú©Û†Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù‡Û•ÚµÛ•ÛŒÛ•', 'error');
        
        if(!db) return showToast('Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª Ù†ÛŒÛŒÛ•', 'error');
        const mid = document.getElementById('mosqueSelect').value;
        const name = document.getElementById('deceasedName').value.trim();
        const time = document.getElementById('prayerTime').value;
        if(!mid || !name || !time) return showToast('Ù¾Ú•Ø¨Ú©Û•Ø±Û•ÙˆÛ•', 'error');
        
        db.ref('funerals/' + mid).set({name, time, timestamp: Date.now()});
        document.getElementById('deceasedName').value = '';
        document.getElementById('prayerTime').value = '';
        showToast('Ø¨ÚµØ§ÙˆÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•');
    }

    function submitMosque() {
        const pass = document.getElementById('adminPass').value;
        if(pass !== '2026') return showToast('Ú©Û†Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù‡Û•ÚµÛ•ÛŒÛ•', 'error');
        
        if(!db) return showToast('Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª Ù†ÛŒÛŒÛ•', 'error');
        const name = document.getElementById('mosqueName').value.trim();
        const lat = parseFloat(document.getElementById('mosqueLat').value);
        const lng = parseFloat(document.getElementById('mosqueLng').value);
        if(!name || isNaN(lat) || isNaN(lng)) return showToast('Ù¾Ú•Ø¨Ú©Û•Ø±Û•ÙˆÛ•', 'error');
        
        const ref = db.ref('customMosques').push();
        ref.set({id: ref.key, name, lat, lng});
        document.getElementById('mosqueName').value = '';
        document.getElementById('mosqueLat').value = '';
        document.getElementById('mosqueLng').value = '';
        showToast('Ù…Ø²Ú¯Û•ÙˆØª Ø²ÛŒØ§Ø¯Ú©Ø±Ø§');
    }

    function useCurrentLocation() {
        if(!userPos) return showToast('Ø´ÙˆÛÙ† Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'error');
        document.getElementById('mosqueLat').value = userPos.lat.toFixed(6);
        document.getElementById('mosqueLng').value = userPos.lng.toFixed(6);
        showToast('Ø´ÙˆÛÙ†ÛŒ Ø¦ÛØ³ØªØ§ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø±Ø§');
    }

    function updateAdminSelect() {
        const s = document.getElementById('mosqueSelect');
        s.innerHTML = '<option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>' + mosques.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
    }

    function updateEditMosqueSelect() {
        const s = document.getElementById('editMosqueSelect');
        // ØªÛ•Ù†Ù‡Ø§ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Ø§Ù†ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§Ùˆ (custom) Ù†ÛŒØ´Ø§Ù† Ø¨Ø¯Û•
        const customMosques = mosques.filter(m => m.id.startsWith('-') || m.id.includes('custom') || !BACKUP_MOSQUES.find(bm => bm.id === m.id));
        
        s.innerHTML = '<option value="">Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option>' + 
            customMosques.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
    }

    function loadMosqueForEdit() {
        const mosqueId = document.getElementById('editMosqueSelect').value;
        if(!mosqueId) {
            document.getElementById('editMosqueForm').classList.add('hidden');
            return;
        }
        
        const mosque = mosques.find(m => m.id === mosqueId);
        if(!mosque) return;
        
        document.getElementById('editMosqueName').value = mosque.name || '';
        document.getElementById('editMosqueLat').value = mosque.lat || '';
        document.getElementById('editMosqueLng').value = mosque.lng || '';
        document.getElementById('editMosqueDesc').value = mosque.description || '';
        
        document.getElementById('editMosqueForm').classList.remove('hidden');
    }

    function updateMosque() {
        const pass = document.getElementById('adminPass').value;
        if(pass !== '2026') return showToast('Ú©Û†Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù‡Û•ÚµÛ•ÛŒÛ•', 'error');
        
        if(!db) return showToast('Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛØª Ù†ÛŒÛŒÛ•', 'error');
        
        const mosqueId = document.getElementById('editMosqueSelect').value;
        if(!mosqueId) return showToast('Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•', 'error');
        
        // Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¨Ú©Û• Ø¦Ø§ÛŒÛ• Ù…Ø²Ú¯Û•ÙˆØªÛÚ©ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ• ÛŒØ§Ù† Ù†Ø§
        const isCustom = mosqueId.startsWith('-') || mosqueId.includes('custom') || !BACKUP_MOSQUES.find(m => m.id === mosqueId);
        if(!isCustom) return showToast('ØªÛ•Ù†Ù‡Ø§ Ù…Ø²Ú¯Û•ÙˆØªÛ• Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù† Ø¯Û•ØªÙˆØ§Ù†Ø±ÛÙ† Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø¨Ú©Ø±ÛÙ†', 'error');
        
        const name = document.getElementById('editMosqueName').value.trim();
        const lat = parseFloat(document.getElementById('editMosqueLat').value);
        const lng = parseFloat(document.getElementById('editMosqueLng').value);
        const description = document.getElementById('editMosqueDesc').value.trim();
        
        if(!name || isNaN(lat) || isNaN(lng)) return showToast('Ù¾Ú•Ø¨Ú©Û•Ø±Û•ÙˆÛ•', 'error');
        
        // Ø¨ÛŒÙ†ÛŒ Ø¦Ø§ÛŒÛ• Ù„Û• Firebase-Û• ÛŒØ§Ù† Ù„Û• Ù„ÛŒØ³ØªÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ†
        if(db) {
            // Ù„Û• Firebase Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø¨Ú©Û•
            db.ref('customMosques').orderByChild('id').equalTo(mosqueId).once('value', (snapshot) => {
                if(snapshot.exists()) {
                    const key = Object.keys(snapshot.val())[0];
                    db.ref('customMosques/' + key).update({
                        name: name,
                        lat: lat,
                        lng: lng,
                        description: description
                    });
                    showToast('Ù…Ø²Ú¯Û•ÙˆØª Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•');
                } else {
                    showToast('Ù…Ø²Ú¯Û•ÙˆØª Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'error');
                }
            });
        } else {
            // Ù„Û• Ù„ÛŒØ³ØªÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø¨Ú©Û•
            const index = mosques.findIndex(m => m.id === mosqueId);
            if(index !== -1) {
                mosques[index].name = name;
                mosques[index].lat = lat;
                mosques[index].lng = lng;
                mosques[index].description = description;
                renderMarkers();
                showToast('Ù…Ø²Ú¯Û•ÙˆØª Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• (Ø¦Û†ÙÙ„Ø§ÛŒÙ†)');
            }
        }
    }

    function deleteMosque() {
        const pass = document.getElementById('adminPass').value;
        if(pass !== '2026') return showToast('Ú©Û†Ø¯ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù‡Û•ÚµÛ•ÛŒÛ•', 'error');
        
        if(!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ù…Ø²Ú¯Û•ÙˆØªÛ•ØŸ')) return;
        
        const mosqueId = document.getElementById('editMosqueSelect').value;
        if(!mosqueId) return showToast('Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•', 'error');
        
        // Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¨Ú©Û• Ø¦Ø§ÛŒÛ• Ù…Ø²Ú¯Û•ÙˆØªÛÚ©ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ• ÛŒØ§Ù† Ù†Ø§
        const isCustom = mosqueId.startsWith('-') || mosqueId.includes('custom') || !BACKUP_MOSQUES.find(m => m.id === mosqueId);
        if(!isCustom) return showToast('ØªÛ•Ù†Ù‡Ø§ Ù…Ø²Ú¯Û•ÙˆØªÛ• Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù† Ø¯Û•ØªÙˆØ§Ù†Ø±ÛÙ† Ø³Ú•Ø¯Ø±ÛÙ†Û•ÙˆÛ•', 'error');
        
        if(db) {
            // Ù„Û• Firebase Ø¨Ø³Ú•Û•ÙˆÛ•
            db.ref('customMosques').orderByChild('id').equalTo(mosqueId).once('value', (snapshot) => {
                if(snapshot.exists()) {
                    const key = Object.keys(snapshot.val())[0];
                    db.ref('customMosques/' + key).remove()
                        .then(() => {
                            showToast('Ù…Ø²Ú¯Û•ÙˆØª Ø³Ú•Ø¯Ø±Ø§ÛŒÛ•ÙˆÛ•');
                            document.getElementById('editMosqueForm').classList.add('hidden');
                            document.getElementById('editMosqueSelect').value = '';
                        })
                        .catch(err => showToast('Ù‡Û•ÚµÛ•: ' + err.message, 'error'));
                }
            });
        } else {
            // Ù„Û• Ù„ÛŒØ³ØªÛŒ Ø¦Û†ÙÙ„Ø§ÛŒÙ† Ø¨Ø³Ú•Û•ÙˆÛ•
            mosques = mosques.filter(m => m.id !== mosqueId);
            renderMarkers();
            updateEditMosqueSelect();
            document.getElementById('editMosqueForm').classList.add('hidden');
            document.getElementById('editMosqueSelect').value = '';
            showToast('Ù…Ø²Ú¯Û•ÙˆØª Ø³Ú•Ø¯Ø±Ø§ÛŒÛ•ÙˆÛ• (Ø¦Û†ÙÙ„Ø§ÛŒÙ†)');
        }
    }

    function updateAdminFuneralList() {
        const list = document.getElementById('adminFuneralList');
        list.innerHTML = '';
        const count = Object.keys(funerals).length;
        if(count === 0) {
            list.innerHTML = '<div class="text-center text-gray-500 text-xs py-4">Ù‡ÛŒÚ† Ù¾Ø±Ø³Û•ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</div>';
            return;
        }
        Object.entries(funerals).forEach(([id, data]) => {
            const m = mosques.find(x => x.id == id);
            if(!m) return;
            const div = document.createElement('div');
            div.className = 'glass-light p-3 rounded-xl flex justify-between border-r-4 border-red-500/30 mb-2';
            div.innerHTML = `<div><p class="text-xs font-bold">${m.name}</p><p class="text-xs text-gray-400">${data.name} - ${data.time}</p></div><button onclick="deleteFuneral('${id}')" class="bg-red-500/20 px-3 py-1 rounded-lg text-red-400 text-xs"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
        });
    }

    function deleteFuneral(id) {
        if(!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØŸ')) return;
        if(db) {
            db.ref('funerals/' + id).remove();
            showToast('Ù¾Ø±Ø³Û• Ø³Ú•Ø¯Ø±Ø§ÛŒÛ•ÙˆÛ•');
        }
    }

    function autoDeleteOldFunerals() {
        if(!db) return;
        db.ref('funerals').once('value', (s) => {
            const d = s.val();
            if(!d) return;
            const now = Date.now();
            Object.entries(d).forEach(([id, f]) => {
                if(now - f.timestamp > 86400000) db.ref('funerals/' + id).remove();
            });
        });
    }

    function locateUser() {
        map.locate({setView: true, maxZoom: 16});
        showToast('Ú¯Û•Ú•Ø§Ù† Ø¨Û† Ø´ÙˆÛÙ†Û•Ú©Û•Øª...');
    }

    function shareLocation() {
        if(!selectedMosque) return showToast('Ù…Ø²Ú¯Û•ÙˆØªÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•', 'error');
        const url = `https://www.google.com/maps/search/?api=1&query=${selectedMosque.lat},${selectedMosque.lng}`;
        if(navigator.share) {
            navigator.share({title: selectedMosque.name, url});
        } else {
            navigator.clipboard.writeText(url);
            showToast('Ù„ÛŒÙ†Ú©ÛŒ Ø´ÙˆÛÙ† Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§');
        }
    }

    function shareApp() {
        const url = window.location.href;
        if(navigator.share) {
            navigator.share({title: 'Ù†Û•Ø®Ø´Û•ÛŒ Ø²ÛŒØ±Û•Ú©ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§', url});
        } else {
            navigator.clipboard.writeText(url);
            showToast('Ù„ÛŒÙ†Ú©ÛŒ Ø¦Û•Ù¾ Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§');
        }
    }

    function toggleModal(id) {
        const m = document.getElementById(id);
        if(m.style.display === 'flex') {
            m.style.display = 'none';
        } else {
            m.style.display = 'flex';
            if(id === 'adminModal') {
                updateAdminSelect();
                updateAdminFuneralList();
            }
        }
    }

    function showToast(msg, type='success') {
        const t = document.getElementById('toastNotif');
        const i = document.getElementById('toastIcon');
        const m = document.getElementById('toastMessage');
        
        i.className = type === 'error' ? 'fas fa-exclamation-circle text-red-400 text-xl' : 'fas fa-check-circle text-green-400 text-xl';
        m.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }
</script>

</body>
</html>
