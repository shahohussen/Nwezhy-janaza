<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Û•Ø®Ø´Û•ÛŒ Ø²ÛŒØ±Û•Ú©ÛŒ Ø­Ø§Ø¬ÛŒØ§ÙˆØ§</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { margin: 0; padding: 0; background: #0f172a; font-family: 'Vazirmatn', sans-serif; overflow: hidden; }
        #map { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 4000; display: none; align-items: center; justify-content: center; padding: 20px; }
        
        /* Splash Screen Animation */
        #splash {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.8s ease-in-out;
        }
        .logo-box {
            width: 100px; height: 100px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 28px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.5);
            animation: pulse-ring 2s infinite;
        }
        @keyframes pulse-ring { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* Markers */
        .funeral-pin { width: 42px; height: 42px; background: #ef4444; border: 3px solid white; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; color: white; animation: bounce 2s infinite; }
        .funeral-pin i { transform: rotate(45deg); }
        .mosque-pin { width: 32px; height: 32px; background: #fbbf24; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) rotate(-45deg); } 50% { transform: translateY(-10px) rotate(-45deg); } }
    </style>
</head>
<body class="text-white text-right">

    <div id="splash">
        <div class="logo-box"><i class="fas fa-kaaba text-5xl text-white"></i></div>
        <h1 class="text-3xl font-black mt-6 tracking-widest">Ø­Ø§Ø¬ÛŒØ§ÙˆØ§ <span class="text-blue-500">Ù…Û•Ù¾</span></h1>
        <div class="w-32 h-1 bg-white/10 mt-6 rounded-full overflow-hidden"><div class="h-full bg-blue-500 w-[60%] animate-[loading_2s_ease-in-out_forwards]"></div></div>
    </div>
    <style> @keyframes loading { 100% { width: 100%; } } </style>

    <div id="map"></div>

    <div class="fixed top-5 left-5 right-5 z-[2000] space-y-3">
        <div class="glass p-3 rounded-2xl flex items-center justify-between shadow-2xl">
            <h1 class="font-black text-lg mr-2 italic tracking-tighter">HAJIAWA <span class="text-blue-400 not-italic font-light text-sm">SMART MAP</span></h1>
            <div class="flex gap-2">
                <button onclick="toggleModal('janazaModal')" class="w-10 h-10 rounded-xl bg-green-500/20 text-green-400 flex items-center justify-center"><i class="fas fa-book-open"></i></button>
                <button onclick="toggleModal('prayerModal')" class="w-10 h-10 rounded-xl bg-blue-500/20 text-blue-400 flex items-center justify-center"><i class="fas fa-clock"></i></button>
                <button onclick="toggleModal('adminOverlay')" class="w-10 h-10 rounded-xl bg-gray-500/20 text-gray-400 flex items-center justify-center"><i class="fas fa-cog"></i></button>
            </div>
        </div>
        <div class="glass p-2 rounded-xl flex items-center gap-2 shadow-lg border border-white/5">
            <i class="fas fa-search text-gray-500 mr-2"></i>
            <input type="text" id="searchInput" oninput="searchMap()" placeholder="Ø¨Ú¯Û•Ú•Û Ø¨Û† Ù…Ø²Ú¯Û•ÙˆØª ÛŒØ§Ù† Ù†Ø§ÙˆÛŒ Ù¾Ø±Ø³Û•..." class="bg-transparent border-none outline-none w-full text-sm py-1 text-white placeholder:text-gray-600">
        </div>
    </div>

    <div id="janazaModal" class="modal" onclick="if(event.target == this) toggleModal('janazaModal')">
        <div class="glass w-full max-w-lg p-6 rounded-[2.5rem] border border-white/10 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-black text-center text-green-400 mb-6">Ú†Û†Ù†ÛŒÛ•ØªÛŒ Ù†ÙˆÛÚ˜ÛŒ Ø¬Û•Ù†Ø§Ø²Û•</h2>
            <div class="space-y-4 text-sm leading-relaxed">
                <div class="bg-white/5 p-4 rounded-2xl border-r-4 border-blue-500">
                    <h3 class="font-bold text-blue-400 mb-1">Ù¡. ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ ÛŒÛ•Ú©Û•Ù…:</h3>
                    <p class="text-gray-300">Ù¾Ø§Ø´ ØªÛ•Ú©Ø¨ÛŒØ± Ø³ÙˆÙˆÚ•Û•ØªÛŒ (Ø§Ù„ÙØ§ØªØ­Ø©) Ø¯Û•Ø®ÙˆÛÙ†Ø±ÛØª.</p>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl border-r-4 border-blue-500">
                    <h3 class="font-bold text-blue-400 mb-1">Ù¢. ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø¯ÙˆÙˆÛ•Ù…:</h3>
                    <p class="text-gray-300">Ø³Û•ÚµØ§ÙˆØ§ØªÛŒ Ø¦ÛŒØ¨Ø±Ø§Ù‡ÛŒÙ…ÛŒ ÙˆÛ•Ú© Ù†Ø§Ùˆ Ù†ÙˆÛÚ˜:</p>
                    <p class="text-[11px] italic mt-1 text-gray-400">(Ø§Ù„Ù„Ù‡Ù… ØµÙ„ Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ ÙˆØ¹Ù„ÛŒ Ø¢Ù„ Ù…Ø­Ù…Ø¯ Ú©Ù…Ø§ ØµÙ„ÛŒØª Ø¹Ù„ÛŒ Ø§Ø¨Ø±Ø§Ù‡ÛŒÙ…...)</p>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl border-r-4 border-green-500">
                    <h3 class="font-bold text-green-400 mb-1">Ù£. ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ø³ÛÛŒÛ•Ù… (Ø¯ÙˆØ¹Ø§ÛŒ Ù…Ø±Ø¯ÙˆÙˆ):</h3>
                    <p class="text-[13px] leading-6 italic text-green-200">
                        "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙ‡Ù ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙØŒ ÙˆÙØ¹ÙØ§ÙÙÙ‡Ù ÙˆÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†Ù’Ù‡ÙØŒ ÙˆÙØ£ÙÙƒÙ’Ø±ÙÙ…Ù’ Ù†ÙØ²ÙÙ„ÙÙ‡ÙØŒ ÙˆÙÙˆÙØ³ÙÙ‘Ø¹Ù’ Ù…ÙØ¯Ù’Ø®ÙÙ„ÙÙ‡ÙØŒ ÙˆÙØ§ØºÙ’Ø³ÙÙ„Ù’Ù‡Ù Ø¨ÙØ§Ù„Ù’Ù…ÙØ§Ø¡Ù ÙˆÙØ§Ù„Ø«ÙÙ‘Ù„Ù’Ø¬Ù ÙˆÙØ§Ù„Ù’Ø¨ÙØ±ÙØ¯ÙØŒ ÙˆÙÙ†ÙÙ‚ÙÙ‘Ù‡Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ø®ÙØ·ÙØ§ÙŠÙØ§ ÙƒÙÙ…ÙØ§ Ù†ÙÙ‚ÙÙ‘ÙŠÙ’ØªÙ Ø§Ù„Ø«ÙÙ‘ÙˆÙ’Ø¨Ù Ø§Ù„Ù’Ø£ÙØ¨Ù’ÙŠÙØ¶Ù Ù…ÙÙ†Ù Ø§Ù„Ø¯ÙÙ‘Ù†ÙØ³Ù."
                    </p>
                    <p class="text-[11px] mt-2 text-gray-400">Ù…Ø§Ù†Ø§Ú©Û•ÛŒ: Ø®ÙˆØ§ÛŒÛ• Ù„ÛÛŒ Ø®Û†Ø´Ø¨Û• Ùˆ Ø¨Û•Ø²Û•ÛŒÛŒØª Ù¾ÛÛŒØ¯Ø§ Ø¨ÛØªÛ•ÙˆÛ• Ùˆ Ø¬ÛÚ¯Ø§ÛŒ Ù¾Ø´ÙˆÙˆØ¯Ø§Ù†ÛŒ Ø¨Û† ÙØ±Ø§ÙˆØ§Ù† Ø¨Ú©Û•...</p>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl border-r-4 border-blue-500">
                    <h3 class="font-bold text-blue-400 mb-1">Ù¤. ØªÛ•Ú©Ø¨ÛŒØ±ÛŒ Ú†ÙˆØ§Ø±Û•Ù…:</h3>
                    <p class="text-gray-300">Ø¯ÙˆØ¹Ø§ÛŒÛ•Ú© Ø¯Û•Ú©Û•ÛŒ Ø¨Û† Ù‡Û•Ù…ÙˆÙˆ Ù…ÙˆØ³ÚµÙ…Ø§Ù†Ø§Ù†:</p>
                    <p class="text-[12px] italic text-gray-400">"Ø§Ù„Ù„Ù‡Ù… Ù„Ø§ ØªØ­Ø±Ù…Ù†Ø§ Ø£Ø¬Ø±Ù‡ ÙˆÙ„Ø§ ØªÙØªÙ†Ø§ Ø¨Ø¹Ø¯Ù‡ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ ÙˆÙ„Ù‡"</p>
                    <p class="mt-2 text-gray-300">Ù¾Ø§Ø´Ø§Ù† ÛŒÛ•Ú© Ø³Û•Ù„Ø§Ù… Ø¯Û•Ø¯Û•ÛŒØªÛ•ÙˆÛ• Ø¨Û† Ù„Ø§ÛŒ Ú•Ø§Ø³Øª.</p>
                </div>
            </div>
            <button onclick="toggleModal('janazaModal')" class="w-full mt-6 py-4 bg-green-600 rounded-2xl font-bold shadow-lg">ØªÛÚ¯Û•ÛŒØ´ØªÙ…ØŒ Ù¾Ø§Ø¯Ø§Ø´ØªØª Ù„Ø§ÛŒ Ø®ÙˆØ§ Ø¨ÛØª</button>
        </div>
    </div>

    <div id="adminOverlay" class="modal" onclick="if(event.target == this) toggleModal('adminOverlay')">
        <div class="glass w-[92%] max-w-md p-6 rounded-[2.5rem] border border-white/10">
            <div class="flex bg-white/5 p-1 rounded-2xl mb-6">
                <button onclick="switchTab('fun')" id="tabFun" class="flex-1 py-2 rounded-xl bg-blue-600 font-bold text-xs">Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Ø±Ø³Û•</button>
                <button onclick="switchTab('mos')" id="tabMos" class="flex-1 py-2 rounded-xl font-bold text-xs text-gray-400">Ù…Ø²Ú¯Û•ÙˆØªÛŒ Ù†ÙˆÛ</button>
            </div>
            
            <input type="password" id="adminPass" placeholder="Ú©Û†Ø¯ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†" class="w-full bg-black/40 p-4 rounded-xl mb-4 outline-none border border-white/5 text-center">

            <div id="sectionFun" class="space-y-4">
                <select id="mosqueSelect" class="w-full bg-slate-800 p-4 rounded-xl outline-none text-white"></select>
                <input type="text" id="deceasedNameInput" placeholder="Ù†Ø§ÙˆÛŒ Ú©Û†Ú†Ú©Ø±Ø¯ÙˆÙˆ" class="w-full bg-black/40 p-4 rounded-xl outline-none border border-white/5">
                <input type="text" id="prayerTimeInput" placeholder="Ú©Ø§ØªÛŒ Ù†ÙˆÛÚ˜ (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û•: Ù¤ÛŒ Ø¹Û•Ø³Ø±)" class="w-full bg-black/40 p-4 rounded-xl outline-none border border-white/5">
                <button onclick="saveFuneral()" class="w-full bg-blue-600 py-4 rounded-xl font-black">Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†</button>
            </div>

            <div id="sectionMos" class="hidden space-y-4">
                <input type="text" id="newMosName" placeholder="Ù†Ø§ÙˆÛŒ Ù…Ø²Ú¯Û•ÙˆØª" class="w-full bg-black/40 p-4 rounded-xl outline-none border border-white/5 text-right">
                <div class="flex gap-2 font-mono">
                    <input type="text" id="newMosLat" placeholder="Lat" class="w-1/2 bg-black/40 p-4 rounded-xl outline-none border border-white/5 text-center text-xs">
                    <input type="text" id="newMosLng" placeholder="Lng" class="w-1/2 bg-black/40 p-4 rounded-xl outline-none border border-white/5 text-center text-xs">
                </div>
                <div class="bg-blue-500/10 p-3 rounded-xl border border-blue-500/20">
                    <p class="text-[11px] text-blue-400 leading-relaxed">
                        <i class="fas fa-info-circle ml-1"></i>
                        <strong>ØªÛØ¨ÛŒÙ†ÛŒ:</strong> Ø¨Û† ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ù¾Û†ØªØ§Ù†Û•Ú©Ø§Ù†ØŒ Ù¾Ø§Ù†ÛÚµÛ•Ú©Û• Ø¯Ø§Ø¨Ø®Û• Ùˆ <strong>Ú©Ù„ÛŒÚ© Ù„Û•Ø³Û•Ø± Ù†Û•Ø®Ø´Û•Ú©Û•</strong> Ø¨Ú©Û• Ù„Û•Ùˆ Ø´ÙˆÛÙ†Û•ÛŒ Ù…Ø²Ú¯Û•ÙˆØªÛ•Ú©Û•ÛŒ Ù„ÛÛŒÛ•.
                    </p>
                </div>
                <button onclick="saveNewMosque()" class="w-full bg-green-600 py-4 rounded-xl font-black">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button>
            </div>
        </div>
    </div>

    <div id="routeInfo" class="fixed bottom-0 left-0 right-0 glass rounded-t-[2.5rem] p-6 z-[2500] translate-y-full transition-transform duration-500 shadow-2xl">
        <div class="w-12 h-1 bg-white/20 rounded-full mx-auto mb-4"></div>
        <h2 id="destName" class="text-2xl font-black mb-1">...</h2>
        <div id="funeralContent" class="hidden mt-3 p-4 rounded-2xl bg-red-500/10 border border-red-500/20">
            <p id="deceasedNameDisplay" class="text-lg font-bold text-red-400"></p>
            <p id="prayerTimeDisplay" class="text-gray-400 mt-1 text-xs"></p>
        </div>
        <div class="flex gap-4 mt-6">
            <button onclick="openNavigation()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-blue-900/40">
                <i class="fas fa-location-arrow"></i> Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ú•ÛÚ¯Ø§
            </button>
            <button onclick="closeRoute()" class="px-6 bg-white/10 rounded-2xl font-bold font-mono">âœ•</button>
        </div>
    </div>

    <div id="prayerModal" class="modal" onclick="if(event.target == this) toggleModal('prayerModal')">
        <div class="glass w-full max-w-sm p-8 rounded-[2.5rem] border border-white/10 shadow-2xl text-center">
            <h2 class="text-2xl font-black mb-4">Ú©Ø§ØªÛŒ Ù†ÙˆÛÚ˜Û•Ú©Ø§Ù†</h2>
            <div id="prayerContainer" class="space-y-3"></div>
            <button onclick="toggleModal('prayerModal')" class="mt-6 text-gray-500 text-xs">Ø¯Ø§Ø®Ø³ØªÙ†</button>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAoPWYvcDV875kkrU2Op7kSUV2GGmqdUkA",
            authDomain: "hajiawa-map-6fca6.firebaseapp.com",
            databaseURL: "https://hajiawa-map-6fca6-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "hajiawa-map-6fca6",
            storageBucket: "hajiawa-map-6fca6.firebasestorage.app",
            messagingSenderId: "631946456317",
            appId: "1:631946456317:web:3e08997a9ec6bd0865a294",
            measurementId: "G-XESHDGKNDZ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let map, allMosques = [], funerals = {};
        const prayerData = [
            { name: "Ø¨Ø§Ù†Ú¯ÛŒ Ø¨Û•ÛŒØ§Ù†ÛŒ", time: "05:37" }, { name: "Ú•Û†Ú˜Ù‡Û•ÚµØ§Øª", time: "07:05" },
            { name: "Ø¨Ø§Ù†Ú¯ÛŒ Ù†ÛŒÙˆÛ•Ú•Û†", time: "12:16" }, { name: "Ø¨Ø§Ù†Ú¯ÛŒ Ø¹Û•Ø³Ø±", time: "15:05" },
            { name: "Ø¨Ø§Ù†Ú¯ÛŒ Ø¦ÛÙˆØ§Ø±Û•", time: "17:28" }, { name: "Ø¨Ø§Ù†Ú¯ÛŒ Ø®Û•ÙˆØªÙ†Ø§Ù†", time: "18:51" }
        ];

        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([36.2369, 44.7869], 14);
        L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', { subdomains:['mt0','mt1','mt2','mt3'] }).addTo(map);

        map.on('click', (e) => {
            document.getElementById('newMosLat').value = e.latlng.lat.toFixed(6);
            document.getElementById('newMosLng').value = e.latlng.lng.toFixed(6);
        });

        async function init() {
            const q = `[out:json];node["amenity"="place_of_worship"]["religion"="muslim"](36.21,44.75,36.26,44.83);out;`;
            let osmData = [];
            try {
                const res = await fetch('https://overpass-api.de/api/interpreter', {method:'POST', body:q});
                const d = await res.json();
                osmData = d.elements.map(e => ({ id: e.id, lat: e.lat, lng: e.lon, name: e.tags['name:ckb'] || e.tags.name || "Ù…Ø²Ú¯Û•ÙˆØª" }));
            } catch(e) {}

            db.ref('customMosques').on('value', (snap) => {
                const custom = snap.val() ? Object.values(snap.val()) : [];
                allMosques = [...osmData, ...custom];
                document.getElementById('mosqueSelect').innerHTML = allMosques.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
                renderMarkers();
            });

            db.ref('funerals').on('value', (snap) => {
                funerals = snap.val() || {};
                renderMarkers();
            });
        }

        function renderMarkers() {
            map.eachLayer(l => { if(l instanceof L.Marker) map.removeLayer(l); });
            allMosques.forEach(m => {
                const isFun = funerals[m.id];
                const icon = L.divIcon({
                    className: 'bg-transparent',
                    html: isFun ? `<div class="funeral-pin"><i class="fas fa-hands-praying"></i></div>` : `<div class="mosque-pin"><i class="fas fa-moon"></i></div>`,
                    iconSize: [40, 40], iconAnchor: [20, 40]
                });
                L.marker([m.lat, m.lng], {icon}).addTo(map).on('click', () => {
                    document.getElementById('destName').innerText = m.name;
                    const funBox = document.getElementById('funeralContent');
                    if(isFun) {
                        funBox.classList.remove('hidden');
                        document.getElementById('deceasedNameDisplay').innerText = "Ø¨Û† Ú©Û†Ú†Ú©Ø±Ø¯ÙˆÙˆ: " + isFun.name;
                        document.getElementById('prayerTimeDisplay').innerText = "ğŸ•’ Ú©Ø§ØªÛŒ Ù†ÙˆÛÚ˜: " + isFun.time;
                    } else { funBox.classList.add('hidden'); }
                    document.getElementById('routeInfo').style.transform = "translateY(0)";
                    map.flyTo([m.lat, m.lng], 16);
                });
            });
        }

        function searchMap() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            const found = allMosques.find(m => m.name.toLowerCase().includes(val));
            if(found) map.flyTo([found.lat, found.lng], 17);
        }

        function toggleModal(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
            if(id === 'prayerModal') {
                document.getElementById('prayerContainer').innerHTML = prayerData.map(p => `<div class="flex justify-between p-3 bg-white/5 rounded-xl border-r-2 border-blue-500"><span>${p.name}</span><span class="text-blue-400 font-bold font-mono">${p.time}</span></div>`).join('');
            }
        }

        function switchTab(tab) {
            const isFun = tab === 'fun';
            document.getElementById('sectionFun').classList.toggle('hidden', !isFun);
            document.getElementById('sectionMos').classList.toggle('hidden', isFun);
            document.getElementById('tabFun').className = isFun ? 'flex-1 py-2 rounded-xl bg-blue-600 font-bold text-xs' : 'flex-1 py-2 rounded-xl font-bold text-xs text-gray-400';
            document.getElementById('tabMos').className = !isFun ? 'flex-1 py-2 rounded-xl bg-green-600 font-bold text-xs' : 'flex-1 py-2 rounded-xl font-bold text-xs text-gray-400';
        }

        function saveFuneral() {
            if(document.getElementById('adminPass').value !== "2026") return alert("Ú©Û†Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•!");
            const id = document.getElementById('mosqueSelect').value;
            const name = document.getElementById('deceasedNameInput').value;
            const time = document.getElementById('prayerTimeInput').value;
            db.ref('funerals/' + id).set({ name, time, timestamp: Date.now() });
            alert("Ø¨ÚµØ§ÙˆÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•");
        }

        function saveNewMosque() {
            if(document.getElementById('adminPass').value !== "2026") return alert("Ú©Û†Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•!");
            const name = document.getElementById('newMosName').value;
            const lat = parseFloat(document.getElementById('newMosLat').value);
            const lng = parseFloat(document.getElementById('newMosLng').value);
            const newRef = db.ref('customMosques').push();
            newRef.set({ id: newRef.key, name, lat, lng });
            alert("Ù…Ø²Ú¯Û•ÙˆØª Ø²ÛŒØ§Ø¯Ú©Ø±Ø§");
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display = 'none', 800);
            }, 2500);
        });

        function closeRoute() { document.getElementById('routeInfo').style.transform = "translateY(100%)"; }
        function openNavigation() { window.open(`https://www.google.com/maps/dir/?api=1&destination=${map.getCenter().lat},${map.getCenter().lng}`); }

        init();
    </script>
</body>
</html>
